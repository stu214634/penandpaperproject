{"version":3,"file":"CombatSessionView-OvyEre1B.js","sources":["../../src/components/ActiveCombatView.tsx","../../src/pages/CombatSessionView.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { \r\n  Box, \r\n  Typography, \r\n  Paper, \r\n  Button, \r\n  IconButton, \r\n  List, \r\n  ListItem, \r\n  ListItemText, \r\n  ListItemIcon,\r\n  TextField,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  Card,\r\n  CardContent,\r\n  Divider,\r\n  Grid,\r\n  Chip,\r\n  Avatar,\r\n  MenuItem,\r\n  Select,\r\n  FormControl,\r\n  InputLabel,\r\n  Badge\r\n} from '@mui/material';\r\nimport { \r\n  ArrowBack as ArrowBackIcon,\r\n  SportsKabaddi as SportsKabaddiIcon,\r\n  Person as PersonIcon,\r\n  AddCircle as AddCircleIcon,\r\n  ArrowForward as ArrowForwardIcon,\r\n  Close as CloseIcon,\r\n  Delete as DeleteIcon,\r\n  Edit as EditIcon\r\n} from '@mui/icons-material';\r\nimport { useStore } from '../store';\r\nimport { Combat, Character } from '../store';\r\nimport MarkdownContent from './MarkdownContent';\r\n\r\n// Interface for combat participants with initiative\r\ninterface CombatParticipant {\r\n  id: string; // Unique ID for this participant instance\r\n  character: Character;\r\n  initiative: number;\r\n  currentHp: number;\r\n  maxHp: number;\r\n  notes: string;\r\n  isPlayerCharacter: boolean;\r\n}\r\n\r\ninterface ActiveCombatViewProps {\r\n  combat: Combat;\r\n  onClose: () => void;\r\n}\r\n\r\nexport const ActiveCombatView: React.FC<ActiveCombatViewProps> = ({ combat, onClose }) => {\r\n  const playTrack = useStore(state => state.playTrack);\r\n  const stopIndividualTrack = useStore(state => state.stopIndividualTrack);\r\n  const characters = useStore(state => state.characters);\r\n  \r\n  // Refs to track audio IDs\r\n  const entrySoundTrackIdRef = useRef<string | null>(null);\r\n  const bgmTrackIdRef = useRef<string | null>(null);\r\n  const audioInitializedRef = useRef(false);\r\n  \r\n  // Combat state\r\n  const [participants, setParticipants] = useState<CombatParticipant[]>([]);\r\n  const [currentTurnIndex, setCurrentTurnIndex] = useState(0);\r\n  const [round, setRound] = useState(1);\r\n  const [isAddParticipantDialogOpen, setIsAddParticipantDialogOpen] = useState(false);\r\n  const [newParticipantId, setNewParticipantId] = useState('');\r\n  const [newParticipantInitiative, setNewParticipantInitiative] = useState(10);\r\n  const [editingParticipantId, setEditingParticipantId] = useState<string | null>(null);\r\n  const [selectedParticipantId, setSelectedParticipantId] = useState<string | null>(null);\r\n  \r\n  // Initialize audio only once when the component mounts\r\n  useEffect(() => {\r\n    if (!audioInitializedRef.current) {\r\n      // Initialize audio\r\n      if (combat.entrySound) {\r\n        const entryTrackId = `/audio/${combat.entrySound}`;\r\n        entrySoundTrackIdRef.current = entryTrackId;\r\n        playTrack(entryTrackId, { \r\n          replace: false, \r\n          locationId: `combat-entrysound-${combat.id}`, \r\n          loop: false \r\n        });\r\n      }\r\n      \r\n      if (combat.backgroundMusic) {\r\n        const bgmTrackId = `/audio/${combat.backgroundMusic}`;\r\n        bgmTrackIdRef.current = bgmTrackId;\r\n        playTrack(bgmTrackId, { \r\n          replace: false, \r\n          locationId: `combat-bgm-${combat.id}`, \r\n          loop: true \r\n        });\r\n      }\r\n      \r\n      audioInitializedRef.current = true;\r\n    }\r\n    \r\n    // Cleanup function to stop tracks when component unmounts\r\n    return () => {\r\n      if (entrySoundTrackIdRef.current) {\r\n        stopIndividualTrack(entrySoundTrackIdRef.current);\r\n        entrySoundTrackIdRef.current = null;\r\n      }\r\n      \r\n      if (bgmTrackIdRef.current) {\r\n        stopIndividualTrack(bgmTrackIdRef.current);\r\n        bgmTrackIdRef.current = null;\r\n      }\r\n    };\r\n  }, [combat.id, combat.entrySound, combat.backgroundMusic]);\r\n  \r\n  // Initialize combat participants only once\r\n  useEffect(() => {\r\n    initializeCombat();\r\n  }, []);\r\n  \r\n  // Initialize combat participants from the combat data\r\n  const initializeCombat = () => {\r\n    // Create participants from player characters\r\n    const playerParticipants = combat.playerCharacters.map(character => ({\r\n      id: `pc-${character.id}-${Math.random().toString(36).substring(2, 9)}`,\r\n      character,\r\n      initiative: 0,\r\n      currentHp: character.hp,\r\n      maxHp: character.hp,\r\n      notes: '',\r\n      isPlayerCharacter: true\r\n    }));\r\n    \r\n    // Create participants from enemies\r\n    const enemyParticipants = combat.enemies.map(character => ({\r\n      id: `enemy-${character.id}-${Math.random().toString(36).substring(2, 9)}`,\r\n      character,\r\n      initiative: Math.floor(Math.random() * 20) + 1, // Random initiative for initial setup\r\n      currentHp: character.hp,\r\n      maxHp: character.hp,\r\n      notes: '',\r\n      isPlayerCharacter: false\r\n    }));\r\n    \r\n    // Combine and sort by initiative\r\n    const allParticipants = [...playerParticipants, ...enemyParticipants]\r\n      .sort((a, b) => b.initiative - a.initiative);\r\n    \r\n    setParticipants(allParticipants);\r\n    setCurrentTurnIndex(0); // Start with the highest initiative\r\n    setRound(1);\r\n  };\r\n  \r\n  // Advance to the next turn in initiative order\r\n  const nextTurn = () => {\r\n    if (participants.length === 0) return;\r\n    \r\n    const nextIndex = (currentTurnIndex + 1) % participants.length;\r\n    setCurrentTurnIndex(nextIndex);\r\n    \r\n    // When turn changes, update selected participant to match the current turn\r\n    setSelectedParticipantId(participants[nextIndex].id);\r\n    \r\n    // If we've looped back to the first participant, increment the round\r\n    if (nextIndex === 0) {\r\n      setRound(prevRound => prevRound + 1);\r\n    }\r\n  };\r\n  \r\n  // Get the current participant (whose turn it is)\r\n  const currentParticipant = participants[currentTurnIndex];\r\n  \r\n  // Get the selected participant (for details panel)\r\n  const selectedParticipant = participants.find(p => p.id === (selectedParticipantId || currentParticipant?.id));\r\n  \r\n  // Update selectedParticipantId on initial load\r\n  useEffect(() => {\r\n    if (currentParticipant && !selectedParticipantId) {\r\n      setSelectedParticipantId(currentParticipant.id);\r\n    }\r\n  }, [currentParticipant]);\r\n  \r\n  // Handle adding a new participant to the combat\r\n  const handleAddParticipant = () => {\r\n    if (!newParticipantId) return;\r\n    \r\n    const character = characters.find(c => c.id === newParticipantId);\r\n    if (!character) return;\r\n    \r\n    const isPlayerCharacter = character.type === 'player';\r\n    \r\n    const newParticipant: CombatParticipant = {\r\n      id: `${isPlayerCharacter ? 'pc' : 'enemy'}-${character.id}-${Math.random().toString(36).substring(2, 9)}`,\r\n      character,\r\n      initiative: newParticipantInitiative,\r\n      currentHp: character.hp,\r\n      maxHp: character.hp,\r\n      notes: '',\r\n      isPlayerCharacter\r\n    };\r\n    \r\n    // Add to participants and resort by initiative\r\n    const updatedParticipants = [...participants, newParticipant]\r\n      .sort((a, b) => b.initiative - a.initiative);\r\n    \r\n    // Find the new index of the current participant to maintain turn\r\n    const currentId = participants[currentTurnIndex]?.id;\r\n    const newCurrentIndex = currentId \r\n      ? updatedParticipants.findIndex(p => p.id === currentId)\r\n      : 0;\r\n    \r\n    setParticipants(updatedParticipants);\r\n    setCurrentTurnIndex(newCurrentIndex >= 0 ? newCurrentIndex : 0);\r\n    setIsAddParticipantDialogOpen(false);\r\n    setNewParticipantId('');\r\n    setNewParticipantInitiative(10);\r\n  };\r\n  \r\n  // Handle updating a participant's initiative\r\n  const handleUpdateInitiative = (participantId: string, initiative: number) => {\r\n    const updatedParticipants = participants.map(p => \r\n      p.id === participantId ? { ...p, initiative } : p\r\n    ).sort((a, b) => b.initiative - a.initiative);\r\n    \r\n    // Find the new index of the current participant to maintain turn\r\n    const currentId = participants[currentTurnIndex]?.id;\r\n    const newCurrentIndex = currentId \r\n      ? updatedParticipants.findIndex(p => p.id === currentId)\r\n      : 0;\r\n    \r\n    setParticipants(updatedParticipants);\r\n    setCurrentTurnIndex(newCurrentIndex >= 0 ? newCurrentIndex : 0);\r\n  };\r\n  \r\n  // Handle updating a participant's HP\r\n  const handleUpdateHp = (participantId: string, hp: number) => {\r\n    setParticipants(participants.map(p => \r\n      p.id === participantId ? { ...p, currentHp: Math.max(0, Math.min(hp, p.maxHp)) } : p\r\n    ));\r\n  };\r\n  \r\n  // Handle updating a participant's notes\r\n  const handleUpdateNotes = (participantId: string, notes: string) => {\r\n    setParticipants(participants.map(p => \r\n      p.id === participantId ? { ...p, notes } : p\r\n    ));\r\n  };\r\n  \r\n  // Handle removing a participant from combat\r\n  const handleRemoveParticipant = (participantId: string) => {\r\n    const index = participants.findIndex(p => p.id === participantId);\r\n    if (index === -1) return;\r\n    \r\n    const updatedParticipants = participants.filter(p => p.id !== participantId);\r\n    \r\n    // If no participants left, close combat\r\n    if (updatedParticipants.length === 0) {\r\n      handleClose();\r\n      return;\r\n    }\r\n    \r\n    // Adjust current turn index if necessary\r\n    let newIndex = currentTurnIndex;\r\n    if (index === currentTurnIndex) {\r\n      // If removing current participant, go to next\r\n      newIndex = currentTurnIndex % updatedParticipants.length;\r\n    } else if (index < currentTurnIndex) {\r\n      // If removing participant before current, adjust index\r\n      newIndex = currentTurnIndex - 1;\r\n    }\r\n    \r\n    setParticipants(updatedParticipants);\r\n    setCurrentTurnIndex(newIndex);\r\n  };\r\n  \r\n  // Handle selecting a participant for viewing/editing\r\n  const handleSelectParticipant = (participantId: string) => {\r\n    setSelectedParticipantId(participantId);\r\n  };\r\n  \r\n  // Handle closing the combat view\r\n  const handleClose = () => {\r\n    // Stop audio tracks\r\n    if (entrySoundTrackIdRef.current) {\r\n      stopIndividualTrack(entrySoundTrackIdRef.current);\r\n      entrySoundTrackIdRef.current = null;\r\n    }\r\n    \r\n    if (bgmTrackIdRef.current) {\r\n      stopIndividualTrack(bgmTrackIdRef.current);\r\n      bgmTrackIdRef.current = null;\r\n    }\r\n    \r\n    // Call parent's onClose\r\n    onClose();\r\n  };\r\n  \r\n  return (\r\n    <Box sx={{ \r\n      height: '100%', \r\n      width: '100%', \r\n      display: 'flex', \r\n      flexDirection: 'column',\r\n      overflow: 'hidden', \r\n      position: 'relative',\r\n      backgroundColor: '#222',\r\n      backgroundImage: combat.backgroundImage ? `url(/images/${combat.backgroundImage})` : 'none',\r\n      backgroundSize: 'cover',\r\n      backgroundPosition: 'center',\r\n    }}>\r\n      {/* Semi-transparent overlay for readability over background image */}\r\n      <Box sx={{ \r\n        position: 'absolute', \r\n        top: 0, \r\n        left: 0, \r\n        right: 0, \r\n        bottom: 0, \r\n        backgroundColor: 'rgba(0, 0, 0, 0.5)',\r\n        zIndex: 0 \r\n      }} />\r\n      \r\n      {/* Header with combat info */}\r\n      <Paper sx={{ \r\n        p: 2, \r\n        mb: 2, \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        backgroundColor: 'rgba(30, 30, 30, 0.9)',\r\n        position: 'relative',\r\n        zIndex: 1\r\n      }}>\r\n        <Box sx={{ display: 'flex', alignItems: 'center' }}>\r\n          <IconButton onClick={handleClose} sx={{ mr: 1 }}>\r\n            <ArrowBackIcon />\r\n          </IconButton>\r\n          <Typography variant=\"h5\">{combat.name}</Typography>\r\n        </Box>\r\n        \r\n        <Box sx={{ display: 'flex', alignItems: 'center', gap: 2 }}>\r\n          <Chip \r\n            label={`Round: ${round}`}\r\n            color=\"primary\"\r\n            variant=\"outlined\"\r\n          />\r\n          <Chip \r\n            label={`Difficulty: ${combat.difficulty || 'Medium'}`}\r\n            color=\"secondary\"\r\n            variant=\"outlined\"\r\n          />\r\n          <Button \r\n            variant=\"contained\" \r\n            color=\"primary\"\r\n            startIcon={<AddCircleIcon />}\r\n            onClick={() => setIsAddParticipantDialogOpen(true)}\r\n          >\r\n            Add Participant\r\n          </Button>\r\n        </Box>\r\n      </Paper>\r\n      \r\n      {/* Main content area */}\r\n      <Box sx={{ \r\n        display: 'flex', \r\n        flex: 1, \r\n        overflow: 'hidden',\r\n        position: 'relative',\r\n        zIndex: 1,\r\n        gap: 2,\r\n        p: 2\r\n      }}>\r\n        {/* Initiative order list */}\r\n        <Paper sx={{ \r\n          width: 300, \r\n          overflow: 'auto',\r\n          backgroundColor: 'rgba(30, 30, 30, 0.8)',\r\n          p: 1\r\n        }}>\r\n          <Typography variant=\"h6\" sx={{ mb: 2, p: 1 }}>Initiative Order</Typography>\r\n          \r\n          <List>\r\n            {participants.map((participant, index) => (\r\n              <ListItem \r\n                key={participant.id}\r\n                sx={{ \r\n                  mb: 1,\r\n                  backgroundColor: index === currentTurnIndex \r\n                    ? 'rgba(255, 165, 0, 0.3)' \r\n                    : participant.id === selectedParticipantId && index !== currentTurnIndex\r\n                      ? 'rgba(25, 118, 210, 0.2)'\r\n                      : 'transparent',\r\n                  borderLeft: index === currentTurnIndex \r\n                    ? '4px solid orange' \r\n                    : participant.id === selectedParticipantId\r\n                      ? '4px solid #1976d2'\r\n                      : '4px solid transparent',\r\n                  transition: 'all 0.3s ease',\r\n                  borderRadius: '4px',\r\n                  cursor: 'pointer'\r\n                }}\r\n                onClick={() => handleSelectParticipant(participant.id)}\r\n                secondaryAction={\r\n                  <IconButton \r\n                    edge=\"end\" \r\n                    size=\"small\" \r\n                    onClick={(e) => {\r\n                      e.stopPropagation(); // Prevent triggering the ListItem click\r\n                      handleRemoveParticipant(participant.id);\r\n                    }}\r\n                  >\r\n                    <DeleteIcon fontSize=\"small\" />\r\n                  </IconButton>\r\n                }\r\n              >\r\n                <ListItemIcon>\r\n                  {participant.isPlayerCharacter ? \r\n                    <PersonIcon color=\"primary\" /> : \r\n                    <SportsKabaddiIcon color=\"error\" />\r\n                  }\r\n                </ListItemIcon>\r\n                \r\n                <ListItemText \r\n                  primary={\r\n                    <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                      <Typography variant=\"body1\">{participant.character.name}</Typography>\r\n                      <Box sx={{ display: 'flex', alignItems: 'center' }}>\r\n                        <Badge \r\n                          badgeContent={participant.initiative} \r\n                          color=\"primary\"\r\n                          sx={{ mr: 1 }}\r\n                        />\r\n                        <IconButton \r\n                          size=\"small\" \r\n                          onClick={(e) => {\r\n                            e.stopPropagation(); // Prevent triggering the ListItem click\r\n                            setEditingParticipantId(participant.id === editingParticipantId ? null : participant.id);\r\n                          }}\r\n                        >\r\n                          <EditIcon fontSize=\"small\" />\r\n                        </IconButton>\r\n                      </Box>\r\n                    </Box>\r\n                  }\r\n                  secondary={\r\n                    <Box>\r\n                      <Typography variant=\"caption\" component=\"div\">\r\n                        HP: {participant.currentHp}/{participant.maxHp}\r\n                      </Typography>\r\n                      {editingParticipantId === participant.id && (\r\n                        <Box sx={{ mt: 1, display: 'flex', flexDirection: 'column', gap: 1 }}>\r\n                          <TextField\r\n                            label=\"Initiative\"\r\n                            type=\"number\"\r\n                            size=\"small\"\r\n                            value={participant.initiative}\r\n                            onChange={(e) => handleUpdateInitiative(participant.id, parseInt(e.target.value) || 0)}\r\n                          />\r\n                          <TextField\r\n                            label=\"Current HP\"\r\n                            type=\"number\"\r\n                            size=\"small\"\r\n                            value={participant.currentHp}\r\n                            onChange={(e) => handleUpdateHp(participant.id, parseInt(e.target.value) || 0)}\r\n                          />\r\n                          <TextField\r\n                            label=\"Notes\"\r\n                            size=\"small\"\r\n                            multiline\r\n                            rows={2}\r\n                            value={participant.notes}\r\n                            onChange={(e) => handleUpdateNotes(participant.id, e.target.value)}\r\n                          />\r\n                        </Box>\r\n                      )}\r\n                    </Box>\r\n                  }\r\n                />\r\n              </ListItem>\r\n            ))}\r\n          </List>\r\n        </Paper>\r\n        \r\n        {/* Active participant details */}\r\n        <Paper sx={{ \r\n          flex: 1, \r\n          p: 2,\r\n          backgroundColor: 'rgba(30, 30, 30, 0.8)',\r\n          display: 'flex',\r\n          flexDirection: 'column'\r\n        }}>\r\n          {selectedParticipant ? (\r\n            <>\r\n              <Box sx={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', mb: 3 }}>\r\n                <Box>\r\n                  <Typography variant=\"h5\">\r\n                    {selectedParticipant.id === currentParticipant?.id \r\n                      ? `Current Turn: ${selectedParticipant.character.name}`\r\n                      : selectedParticipant.character.name\r\n                    }\r\n                  </Typography>\r\n                  {selectedParticipant.id !== currentParticipant?.id && (\r\n                    <Typography variant=\"caption\" color=\"text.secondary\">\r\n                      Viewing details - not the active turn\r\n                    </Typography>\r\n                  )}\r\n                </Box>\r\n                <Button \r\n                  variant=\"contained\" \r\n                  color=\"secondary\"\r\n                  endIcon={<ArrowForwardIcon />}\r\n                  onClick={nextTurn}\r\n                >\r\n                  Next Turn\r\n                </Button>\r\n              </Box>\r\n              \r\n              <Grid container spacing={2}>\r\n                <Grid item xs={12} md={6}>\r\n                  <Card sx={{ backgroundColor: 'rgba(40, 40, 40, 0.9)', height: '100%' }}>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Character Details\r\n                      </Typography>\r\n                      <Typography variant=\"body1\">\r\n                        Type: {selectedParticipant.character.type.toUpperCase()}\r\n                      </Typography>\r\n                      <Typography variant=\"body1\">\r\n                        HP: {selectedParticipant.currentHp}/{selectedParticipant.maxHp}\r\n                      </Typography>\r\n                      <Box sx={{ mt: 2 }}>\r\n                        {selectedParticipant.character.descriptionType === 'markdown' && (\r\n                          <MarkdownContent content={selectedParticipant.character.description} />\r\n                        )}\r\n                        {(!selectedParticipant.character.descriptionType || selectedParticipant.character.descriptionType !== 'markdown') && (\r\n                          <Typography variant=\"body2\">\r\n                            {selectedParticipant.character.description}\r\n                          </Typography>\r\n                        )}\r\n                      </Box>\r\n                      \r\n                      {/* HP adjustment controls */}\r\n                      <Box sx={{ mt: 3 }}>\r\n                        <Typography variant=\"subtitle2\" gutterBottom>Adjust HP</Typography>\r\n                        <Box sx={{ display: 'flex', gap: 1 }}>\r\n                          <Button \r\n                            variant=\"outlined\" \r\n                            size=\"small\"\r\n                            onClick={() => handleUpdateHp(selectedParticipant.id, selectedParticipant.currentHp - 1)}\r\n                          >\r\n                            -1\r\n                          </Button>\r\n                          <Button \r\n                            variant=\"outlined\" \r\n                            size=\"small\"\r\n                            onClick={() => handleUpdateHp(selectedParticipant.id, selectedParticipant.currentHp - 5)}\r\n                          >\r\n                            -5\r\n                          </Button>\r\n                          <Button \r\n                            variant=\"outlined\" \r\n                            color=\"primary\"\r\n                            size=\"small\"\r\n                            onClick={() => handleUpdateHp(selectedParticipant.id, selectedParticipant.currentHp + 1)}\r\n                          >\r\n                            +1\r\n                          </Button>\r\n                          <Button \r\n                            variant=\"outlined\" \r\n                            color=\"primary\"\r\n                            size=\"small\"\r\n                            onClick={() => handleUpdateHp(selectedParticipant.id, selectedParticipant.currentHp + 5)}\r\n                          >\r\n                            +5\r\n                          </Button>\r\n                        </Box>\r\n                      </Box>\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                \r\n                <Grid item xs={12} md={6}>\r\n                  <Card sx={{ backgroundColor: 'rgba(40, 40, 40, 0.9)', height: '100%' }}>\r\n                    <CardContent>\r\n                      <Typography variant=\"h6\" gutterBottom>\r\n                        Combat Notes\r\n                      </Typography>\r\n                      <TextField\r\n                        fullWidth\r\n                        multiline\r\n                        rows={8}\r\n                        value={selectedParticipant.notes}\r\n                        onChange={(e) => handleUpdateNotes(selectedParticipant.id, e.target.value)}\r\n                        placeholder=\"Add notes for this character...\"\r\n                        variant=\"outlined\"\r\n                      />\r\n                    </CardContent>\r\n                  </Card>\r\n                </Grid>\r\n                \r\n                {selectedParticipant.character.inventory && selectedParticipant.character.inventory.length > 0 && (\r\n                  <Grid item xs={12}>\r\n                    <Card sx={{ backgroundColor: 'rgba(40, 40, 40, 0.9)' }}>\r\n                      <CardContent>\r\n                        <Typography variant=\"h6\" gutterBottom>\r\n                          Inventory\r\n                        </Typography>\r\n                        <List dense>\r\n                          {selectedParticipant.character.inventory.map(item => (\r\n                            <ListItem key={item.id}>\r\n                              <ListItemText \r\n                                primary={item.name} \r\n                                secondary={item.description} \r\n                              />\r\n                              <Typography variant=\"body2\">\r\n                                Qty: {item.quantity}\r\n                              </Typography>\r\n                            </ListItem>\r\n                          ))}\r\n                        </List>\r\n                      </CardContent>\r\n                    </Card>\r\n                  </Grid>\r\n                )}\r\n              </Grid>\r\n            </>\r\n          ) : (\r\n            <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100%' }}>\r\n              <Typography variant=\"h6\">No participants in combat</Typography>\r\n            </Box>\r\n          )}\r\n        </Paper>\r\n      </Box>\r\n      \r\n      {/* Add participant dialog */}\r\n      <Dialog \r\n        open={isAddParticipantDialogOpen} \r\n        onClose={() => setIsAddParticipantDialogOpen(false)}\r\n        maxWidth=\"sm\"\r\n        fullWidth\r\n      >\r\n        <DialogTitle>Add Combat Participant</DialogTitle>\r\n        <DialogContent>\r\n          <Box sx={{ mt: 2, display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n            <FormControl fullWidth>\r\n              <InputLabel>Character</InputLabel>\r\n              <Select\r\n                value={newParticipantId}\r\n                onChange={(e) => setNewParticipantId(e.target.value as string)}\r\n                label=\"Character\"\r\n              >\r\n                <MenuItem value=\"\" disabled>Select a character</MenuItem>\r\n                {characters.map(char => (\r\n                  <MenuItem key={char.id} value={char.id}>\r\n                    {char.name} ({char.type}) - HP: {char.hp}\r\n                  </MenuItem>\r\n                ))}\r\n              </Select>\r\n            </FormControl>\r\n            \r\n            <TextField\r\n              label=\"Initiative\"\r\n              type=\"number\"\r\n              value={newParticipantInitiative}\r\n              onChange={(e) => setNewParticipantInitiative(parseInt(e.target.value) || 0)}\r\n              fullWidth\r\n            />\r\n          </Box>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={() => setIsAddParticipantDialogOpen(false)}>Cancel</Button>\r\n          <Button \r\n            onClick={handleAddParticipant} \r\n            color=\"primary\" \r\n            variant=\"contained\"\r\n            disabled={!newParticipantId}\r\n          >\r\n            Add\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Box>\r\n  );\r\n}; ","import React, { useEffect } from 'react';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { Box, Typography, Button } from '@mui/material';\r\nimport { useStore } from '../store';\r\nimport { Combat } from '../store';\r\nimport { ActiveCombatView } from '../components/ActiveCombatView';\r\n\r\nexport const CombatSessionView: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const combats = useStore(state => state.combats);\r\n  \r\n  // Get the combat ID from the URL state\r\n  const combatId = location.state?.combatId;\r\n  const combat = combats.find(c => c.id === combatId);\r\n  \r\n  // If no combat is selected, redirect back to the map view\r\n  useEffect(() => {\r\n    if (!combatId || !combat) {\r\n      navigate('/map');\r\n    }\r\n  }, [combatId, combat, navigate]);\r\n  \r\n  // Handle going back to the previous screen\r\n  const handleClose = () => {\r\n    navigate(-1); // Go back to previous page\r\n  };\r\n  \r\n  // Return a loading state if the combat isn't found\r\n  if (!combat) {\r\n    return (\r\n      <Box sx={{ \r\n        display: 'flex', \r\n        flexDirection: 'column', \r\n        alignItems: 'center', \r\n        justifyContent: 'center',\r\n        height: '100%',\r\n        p: 3\r\n      }}>\r\n        <Typography variant=\"h6\">Loading combat...</Typography>\r\n        <Button onClick={() => navigate('/map')} sx={{ mt: 2 }}>\r\n          Return to Map\r\n        </Button>\r\n      </Box>\r\n    );\r\n  }\r\n  \r\n  return (\r\n    <Box sx={{ \r\n      height: '100%',\r\n      display: 'flex',\r\n      flexDirection: 'column'\r\n    }}>\r\n      <ActiveCombatView combat={combat} onClose={handleClose} />\r\n    </Box>\r\n  );\r\n}; "],"names":["ActiveCombatView","combat","onClose","playTrack","useStore","state","stopIndividualTrack","characters","entrySoundTrackIdRef","useRef","bgmTrackIdRef","audioInitializedRef","participants","setParticipants","useState","currentTurnIndex","setCurrentTurnIndex","round","setRound","isAddParticipantDialogOpen","setIsAddParticipantDialogOpen","newParticipantId","setNewParticipantId","newParticipantInitiative","setNewParticipantInitiative","editingParticipantId","setEditingParticipantId","selectedParticipantId","setSelectedParticipantId","useEffect","entryTrackId","bgmTrackId","initializeCombat","playerParticipants","character","enemyParticipants","allParticipants","a","b","nextTurn","nextIndex","prevRound","currentParticipant","selectedParticipant","p","handleAddParticipant","c","isPlayerCharacter","newParticipant","updatedParticipants","currentId","_a","newCurrentIndex","handleUpdateInitiative","participantId","initiative","handleUpdateHp","hp","handleUpdateNotes","notes","handleRemoveParticipant","index","handleClose","newIndex","handleSelectParticipant","jsxs","Box","jsx","Paper","IconButton","ArrowBackIcon","Typography","Chip","Button","AddCircleIcon","List","participant","ListItem","e","DeleteIcon","ListItemIcon","PersonIcon","SportsKabaddiIcon","ListItemText","Badge","EditIcon","TextField","Fragment","ArrowForwardIcon","Grid","Card","CardContent","MarkdownContent","item","Dialog","DialogTitle","DialogContent","FormControl","InputLabel","Select","MenuItem","char","DialogActions","CombatSessionView","navigate","useNavigate","location","useLocation","combats","combatId"],"mappings":"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"}