import{i as X,j as t,B as d,d as m,e as h,P as Ie,l as I,m as W,n as w,N as i,o,a6 as x,a2 as p,F as N,S as q,q as R,I as f,r as M,ad as We,X as we,Y as Me,ae as Pe}from"./mui-vendor-ZU7BHlQy.js";import{r as l}from"./react-vendor-BzdEknB4.js";import{r as H,u as _e,f as Ee,e as P,g as Y,a as De,d as Ae,b as _,h as $e,i as Ue,j as Oe}from"./index-RG1VVwYr.js";import{d as Te}from"./Edit-iaAfuQGx.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var E={},Be=X;Object.defineProperty(E,"__esModule",{value:!0});var G=E.default=void 0,Fe=Be(H()),ze=t;G=E.default=(0,Fe.default)((0,ze.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var D={},Ne=X;Object.defineProperty(D,"__esModule",{value:!0});var V=D.default=void 0,qe=Ne(H()),Re=t;V=D.default=(0,qe.default)((0,Re.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const Ke=()=>{const[J,g]=l.useState(!1),[K,L]=l.useState(!1),[Q,A]=l.useState(!1),[Z,ee]=l.useState(""),[n,s]=l.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),[C,$]=l.useState(null),[y,te]=l.useState([]),[U,ne]=l.useState([]),[O,T]=l.useState(!1),[ae,ie]=l.useState({}),[se,S]=l.useState(!1),[oe,re]=l.useState(""),[le,de]=l.useState(""),{locations:c,addLocation:ce,updateLocation:ue,deleteLocation:xe,getAllTopLevelLocations:he,getSublocationsByParentId:me,saveDataToIndexedDB:pe}=_e(),ge=he();l.useEffect(()=>{(async()=>{try{const a=await _.getAssets("audio");te(a.map(u=>u.name));const r=await _.getAssets("images");ne(r.map(u=>u.name))}catch(a){console.error("Error loading assets:",a)}})()},[]);const je=()=>{ce({name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,coordinates:n.coordinates.every(e=>e!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),g(!1),k(),v("Location added successfully")},k=()=>{s({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]})},fe=e=>{ie(a=>({...a,[e]:!a[e]}))},ve=e=>{const a=c.find(r=>r.id===e);a&&($(e),s({name:a.name,description:a.description,backgroundMusic:a.backgroundMusic||"",entrySound:a.entrySound||"",imageUrl:a.imageUrl||"",parentLocationId:a.parentLocationId||"",coordinates:a.coordinates||[0,0],mixWithParent:a.mixWithParent||!1,connectedLocations:a.connectedLocations||[]}),L(!0))},be=()=>{C&&(ue(C,{name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,coordinates:n.coordinates.every(e=>e!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),L(!1),k(),$(null),v("Location updated successfully"))},Le=e=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(xe(e),v("Location deleted successfully"))},Ce=async()=>{T(!0);try{const e=await pe();v(e.message)}catch(e){v(`Error saving data: ${e instanceof Error?e.message:String(e)}`)}finally{T(!1)}},v=e=>{ee(e),A(!0)},ye=()=>{A(!1)},B=(e,a=0)=>{const r=ae[e.id]||!1,u=me(e.id),F=u.length>0;return t.jsxs(d,{sx:{mb:2},children:[t.jsxs(we,{children:[t.jsx(Me,{children:t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[t.jsxs(d,{children:[t.jsx(m,{variant:"h6",component:"div",children:e.name}),e.imageUrl&&t.jsxs(d,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[t.jsx(m,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),t.jsx(d,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:t.jsx("img",{src:`/images/${e.imageUrl}`,alt:`Map of ${e.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async b=>{try{if(e.imageUrl){const j=await _.getAssetUrl("images",e.imageUrl);j&&(b.target.src=j)}}catch(j){console.error("Error loading location image:",j)}}})})]}),t.jsxs(d,{onClick:()=>{re(e.description),de(e.name),S(!0)},sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},borderRadius:1,p:1,mt:1},children:[t.jsx(m,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.description}),e.description.length>100&&t.jsx(m,{variant:"caption",color:"primary",sx:{display:"block",mt:.5},children:"Click to view full description"})]}),t.jsxs(d,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[e.backgroundMusic&&t.jsx(p,{icon:t.jsx(V,{}),label:`Music: ${e.backgroundMusic}`,size:"small",variant:"outlined"}),e.entrySound&&t.jsx(p,{icon:t.jsx($e,{}),label:`Sound: ${e.entrySound}`,size:"small",variant:"outlined"}),e.coordinates&&t.jsx(p,{label:`Coords: ${e.coordinates[0]}, ${e.coordinates[1]}`,size:"small",variant:"outlined"}),e.mixWithParent&&t.jsx(p,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"}),e.connectedLocations&&e.connectedLocations.length>0&&t.jsx(p,{label:`${e.connectedLocations.length} Connected Locations`,size:"small",color:"success",variant:"outlined",onClick:b=>{b.stopPropagation();const j=e.connectedLocations.map(Se=>{var z;return((z=c.find(ke=>ke.id===Se))==null?void 0:z.name)||"Unknown"}).join(", ");alert(`Connected to: ${j}`)}})]})]}),t.jsxs(d,{children:[t.jsx(f,{onClick:()=>ve(e.id),children:t.jsx(Te,{})}),t.jsx(f,{onClick:()=>Le(e.id),children:t.jsx(Ue,{})}),F&&t.jsx(f,{onClick:()=>fe(e.id),children:r?t.jsx(G,{}):t.jsx(Oe,{})})]})]})}),t.jsx(Pe,{sx:{justifyContent:"flex-end",pt:0},children:t.jsx(h,{size:"small",startIcon:t.jsx(P,{}),onClick:()=>{s({...n,parentLocationId:e.id}),g(!0)},children:"Add Sublocation"})})]}),F&&r&&t.jsx(d,{sx:{pl:4,mt:1},children:u.map(b=>B(b,a+1))})]},e.id)};return t.jsxs(d,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[t.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[t.jsx(m,{variant:"h4",children:"Locations"}),t.jsxs(d,{children:[t.jsx(h,{variant:"outlined",color:"success",startIcon:t.jsx(Ee,{}),onClick:Ce,disabled:O,sx:{mr:2},children:O?"Saving...":"Save Changes"}),t.jsx(h,{variant:"contained",startIcon:t.jsx(P,{}),onClick:()=>{k(),g(!0)},children:"Add Location"})]})]}),c.length===0?t.jsxs(Ie,{sx:{p:3,textAlign:"center"},children:[t.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),t.jsx(m,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),t.jsx(h,{variant:"contained",startIcon:t.jsx(P,{}),onClick:()=>g(!0),children:"Add Location"})]}):t.jsx(d,{children:ge.map(e=>B(e))}),t.jsxs(I,{open:J,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(W,{children:"Add New Location"}),t.jsx(w,{children:t.jsxs(i,{container:!0,spacing:2,sx:{mt:.5},children:[t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:e=>s({...n,name:e.target.value})})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:c,value:c.find(e=>e.id===n.parentLocationId)||null,onChange:(e,a)=>s({...n,parentLocationId:(a==null?void 0:a.id)||""}),getOptionLabel:e=>e.name,renderInput:e=>t.jsx(o,{...e,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(e,a)=>e.id===a.id})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:e=>s({...n,description:e.target.value})})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(x,{multiple:!0,options:c.filter(e=>e.id!==n.parentLocationId),value:c.filter(e=>n.connectedLocations.includes(e.id)),onChange:(e,a)=>s({...n,connectedLocations:a.map(r=>r.id)}),getOptionLabel:e=>e.name,renderInput:e=>t.jsx(o,{...e,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(e,a)=>e.id===a.id,renderTags:(e,a)=>e.map((r,u)=>l.createElement(p,{label:r.name,...a({index:u}),key:r.id}))})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:y,value:n.backgroundMusic,onChange:(e,a)=>s({...n,backgroundMusic:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:y,value:n.entrySound,onChange:(e,a)=>s({...n,entrySound:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:U,value:n.imageUrl,onChange:(e,a)=>s({...n,imageUrl:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsxs(i,{container:!0,spacing:1,children:[t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:e=>s({...n,coordinates:[parseFloat(e.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:e=>s({...n,coordinates:[n.coordinates[0],parseFloat(e.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(N,{control:t.jsx(q,{checked:n.mixWithParent,onChange:e=>s({...n,mixWithParent:e.target.checked})}),label:"Mix audio with parent location"}),t.jsx(R,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:t.jsx(f,{size:"small",children:t.jsx(Y,{fontSize:"small"})})})]})]})}),t.jsxs(M,{children:[t.jsx(h,{onClick:()=>g(!1),children:"Cancel"}),t.jsx(h,{onClick:je,variant:"contained",disabled:!n.name,children:"Add Location"})]})]}),t.jsxs(I,{open:K,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(W,{children:"Edit Location"}),t.jsx(w,{children:t.jsxs(i,{container:!0,spacing:2,sx:{mt:.5},children:[t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:e=>s({...n,name:e.target.value})})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:c.filter(e=>e.id!==C),value:c.find(e=>e.id===n.parentLocationId)||null,onChange:(e,a)=>s({...n,parentLocationId:(a==null?void 0:a.id)||""}),getOptionLabel:e=>e.name,renderInput:e=>t.jsx(o,{...e,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(e,a)=>e.id===a.id})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:e=>s({...n,description:e.target.value})})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(x,{multiple:!0,options:c.filter(e=>e.id!==C&&e.id!==n.parentLocationId),value:c.filter(e=>n.connectedLocations.includes(e.id)),onChange:(e,a)=>s({...n,connectedLocations:a.map(r=>r.id)}),getOptionLabel:e=>e.name,renderInput:e=>t.jsx(o,{...e,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(e,a)=>e.id===a.id,renderTags:(e,a)=>e.map((r,u)=>l.createElement(p,{label:r.name,...a({index:u}),key:r.id}))})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:y,value:n.backgroundMusic,onChange:(e,a)=>s({...n,backgroundMusic:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:y,value:n.entrySound,onChange:(e,a)=>s({...n,entrySound:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsx(x,{options:U,value:n.imageUrl,onChange:(e,a)=>s({...n,imageUrl:a||""}),renderInput:e=>t.jsx(o,{...e,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),t.jsx(i,{item:!0,xs:12,md:6,children:t.jsxs(i,{container:!0,spacing:1,children:[t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:e=>s({...n,coordinates:[parseFloat(e.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),t.jsx(i,{item:!0,xs:6,children:t.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:e=>s({...n,coordinates:[n.coordinates[0],parseFloat(e.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),t.jsxs(i,{item:!0,xs:12,children:[t.jsx(N,{control:t.jsx(q,{checked:n.mixWithParent,onChange:e=>s({...n,mixWithParent:e.target.checked})}),label:"Mix audio with parent location"}),t.jsx(R,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:t.jsx(f,{size:"small",children:t.jsx(Y,{fontSize:"small"})})})]})]})}),t.jsxs(M,{children:[t.jsx(h,{onClick:()=>L(!1),children:"Cancel"}),t.jsx(h,{onClick:be,variant:"contained",disabled:!n.name,children:"Save Changes"})]})]}),t.jsx(We,{open:Q,autoHideDuration:6e3,onClose:ye,message:Z}),t.jsx(De,{}),t.jsxs(I,{open:se,onClose:()=>S(!1),maxWidth:"md",fullWidth:!0,children:[t.jsxs(W,{children:[le," - Description",t.jsx(f,{"aria-label":"close",onClick:()=>S(!1),sx:{position:"absolute",right:8,top:8},children:t.jsx(Ae,{})})]}),t.jsx(w,{dividers:!0,children:t.jsx(m,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:oe})}),t.jsx(M,{children:t.jsx(h,{onClick:()=>S(!1),children:"Close"})})]})]})};export{Ke as LocationsView};
//# sourceMappingURL=LocationsView-CKIMuSil.js.map
