import{i as Mi,j as a,B as j,G as gi,d as A,P as yi,O as bi,Q as Pe,L as q,I as U,a0 as bn,a1 as Sn,a2 as Re,M as Si,a3 as He,e as le,l as ke,m as xi,a4 as xn,n as Ci,a5 as Cn,o as I,a6 as Fe,a7 as Ve,a8 as $e,a9 as he,F as wn,aa as jn,r as Pn,ab as wi,f as R,ac as An,g as de,h as H,z as Ke,ad as Qe,ae as ji,k as ge,q as Pi,E as Ai,y as Ti}from"./mui-vendor-uU3VvFzt.js";import{a as ie,r as T,i as Tn}from"./react-vendor-BzdEknB4.js";import{r as Bi,u as z,A as Yi,d as qe,a as We,b as ye,c as Yn}from"./index-CmSG-kMy.js";import{h as Xn}from"./utilities-BTDtKTyc.js";import"./map-vendor-CMk8R3PE.js";var $=function(e,r){return Number(e.toFixed(r))},zn=function(e,r){return r},E=function(e,r,i){i&&typeof i=="function"&&i(e,r)},Dn=function(e){return-Math.cos(e*Math.PI)/2+.5},En=function(e){return e},kn=function(e){return e*e},Wn=function(e){return e*(2-e)},Nn=function(e){return e<.5?2*e*e:-1+(4-2*e)*e},_n=function(e){return e*e*e},Mn=function(e){return--e*e*e+1},Bn=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},Ln=function(e){return e*e*e*e},On=function(e){return 1- --e*e*e*e},Zn=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},Rn=function(e){return e*e*e*e*e},Hn=function(e){return 1+--e*e*e*e*e},Fn=function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e},Li={easeOut:Dn,linear:En,easeInQuad:kn,easeOutQuad:Wn,easeInOutQuad:Nn,easeInCubic:_n,easeOutCubic:Mn,easeInOutCubic:Bn,easeInQuart:Ln,easeOutQuart:On,easeInOutQuart:Zn,easeInQuint:Rn,easeOutQuint:Hn,easeInOutQuint:Fn},Oi=function(e){typeof e=="number"&&cancelAnimationFrame(e)},Q=function(e){e.mounted&&(Oi(e.animation),e.animate=!1,e.animation=null,e.velocity=null)};function Zi(e,r,i,n){if(e.mounted){var t=new Date().getTime(),o=1;Q(e),e.animation=function(){if(!e.mounted)return Oi(e.animation);var s=new Date().getTime()-t,l=s/i,c=Li[r],m=c(l);s>=i?(n(o),e.animation=null):e.animation&&(n(m),requestAnimationFrame(e.animation))},requestAnimationFrame(e.animation)}}function Vn(e){var r=e.scale,i=e.positionX,n=e.positionY;return!(Number.isNaN(r)||Number.isNaN(i)||Number.isNaN(n))}function re(e,r,i,n){var t=Vn(r);if(!(!e.mounted||!t)){var o=e.setTransformState,s=e.transformState,l=s.scale,c=s.positionX,m=s.positionY,p=r.scale-l,d=r.positionX-c,h=r.positionY-m;i===0?o(r.scale,r.positionX,r.positionY):Zi(e,n,i,function(y){var S=l+p*y,P=c+d*y,Y=m+h*y;o(S,P,Y)})}}function $n(e,r,i){var n=e.offsetWidth,t=e.offsetHeight,o=r.offsetWidth,s=r.offsetHeight,l=o*i,c=s*i,m=n-l,p=t-c;return{wrapperWidth:n,wrapperHeight:t,newContentWidth:l,newDiffWidth:m,newContentHeight:c,newDiffHeight:p}}var Kn=function(e,r,i,n,t,o,s){var l=e>r?i*(s?1:.5):0,c=n>t?o*(s?1:.5):0,m=e-r-l,p=l,d=n-t-c,h=c;return{minPositionX:m,maxPositionX:p,minPositionY:d,maxPositionY:h}},ni=function(e,r){var i=e.wrapperComponent,n=e.contentComponent,t=e.setup.centerZoomedOut;if(!i||!n)throw new Error("Components are not mounted");var o=$n(i,n,r),s=o.wrapperWidth,l=o.wrapperHeight,c=o.newContentWidth,m=o.newDiffWidth,p=o.newContentHeight,d=o.newDiffHeight,h=Kn(s,c,m,l,p,d,!!t);return h},Je=function(e,r,i,n){return n?e<r?$(r,2):e>i?$(i,2):$(e,2):$(e,2)},ue=function(e,r){var i=ni(e,r);return e.bounds=i,i};function Te(e,r,i,n,t,o,s){var l=i.minPositionX,c=i.minPositionY,m=i.maxPositionX,p=i.maxPositionY,d=0,h=0;s&&(d=t,h=o);var y=Je(e,l-d,m+d,n),S=Je(r,c-h,p+h,n);return{x:y,y:S}}function Me(e,r,i,n,t,o){var s=e.transformState,l=s.scale,c=s.positionX,m=s.positionY,p=n-l;if(typeof r!="number"||typeof i!="number")return console.error("Mouse X and Y position were not provided!"),{x:c,y:m};var d=c-r*p,h=m-i*p,y=Te(d,h,t,o,0,0,null);return y}function Ye(e,r,i,n,t){var o=t?n:0,s=r-o;return!Number.isNaN(i)&&e>=i?i:!Number.isNaN(r)&&e<=s?s:e}var Xi=function(e,r){var i=e.setup.panning.excluded,n=e.isInitialized,t=e.wrapperComponent,o=r.target,s="shadowRoot"in o&&"composedPath"in r,l=s?r.composedPath().some(function(p){return p instanceof Element?t==null?void 0:t.contains(p):!1}):t==null?void 0:t.contains(o),c=n&&o&&l;if(!c)return!1;var m=Be(o,i);return!m},zi=function(e){var r=e.isInitialized,i=e.isPanning,n=e.setup,t=n.panning.disabled,o=r&&i&&!t;return!!o},Qn=function(e,r){var i=e.transformState,n=i.positionX,t=i.positionY;e.isPanning=!0;var o=r.clientX,s=r.clientY;e.startCoords={x:o-n,y:s-t}},qn=function(e,r){var i=r.touches,n=e.transformState,t=n.positionX,o=n.positionY;e.isPanning=!0;var s=i.length===1;if(s){var l=i[0].clientX,c=i[0].clientY;e.startCoords={x:l-t,y:c-o}}};function Un(e){var r=e.transformState,i=r.positionX,n=r.positionY,t=r.scale,o=e.setup,s=o.disabled,l=o.limitToBounds,c=o.centerZoomedOut,m=e.wrapperComponent;if(!(s||!m||!e.bounds)){var p=e.bounds,d=p.maxPositionX,h=p.minPositionX,y=p.maxPositionY,S=p.minPositionY,P=i>d||i<h,Y=n>y||n<S,x=i>d?m.offsetWidth:e.setup.minPositionX||0,M=n>y?m.offsetHeight:e.setup.minPositionY||0,W=Me(e,x,M,t,e.bounds,l||c),F=W.x,C=W.y;return{scale:t,positionX:P?F:i,positionY:Y?C:n}}}function Ri(e,r,i,n,t){var o=e.setup.limitToBounds,s=e.wrapperComponent,l=e.bounds,c=e.transformState,m=c.scale,p=c.positionX,d=c.positionY;if(!(s===null||l===null||r===p&&i===d)){var h=Te(r,i,l,o,n,t,s),y=h.x,S=h.y;e.setTransformState(m,y,S)}}var Gn=function(e,r,i){var n=e.startCoords,t=e.transformState,o=e.setup.panning,s=o.lockAxisX,l=o.lockAxisY,c=t.positionX,m=t.positionY;if(!n)return{x:c,y:m};var p=r-n.x,d=i-n.y,h=s?c:p,y=l?m:d;return{x:h,y}},ne=function(e,r){var i=e.setup,n=e.transformState,t=n.scale,o=i.minScale,s=i.disablePadding;return r>0&&t>=o&&!s?r:0},Jn=function(e){var r=e.mounted,i=e.setup,n=i.disabled,t=i.velocityAnimation,o=e.transformState.scale,s=t.disabled,l=!s||o>1||!n||r;return!!l},In=function(e){var r=e.mounted,i=e.velocity,n=e.bounds,t=e.setup,o=t.disabled,s=t.velocityAnimation,l=e.transformState.scale,c=s.disabled,m=!c||l>1||!o||r;return!(!m||!i||!n)};function er(e,r){var i=e.setup.velocityAnimation,n=i.equalToMove,t=i.animationTime,o=i.sensitivity;return n?t*r*o:t}function Di(e,r,i,n,t,o,s,l,c,m){if(t){if(r>s&&i>s){var p=s+(e-s)*m;return p>c?c:p<s?s:p}if(r<o&&i<o){var p=o+(e-o)*m;return p<l?l:p>o?o:p}}return n?r:Je(e,o,s,t)}function ir(e,r){var i=1;return r?Math.min(i,e.offsetWidth/window.innerWidth):i}function nr(e,r){var i=Jn(e);if(i){var n=e.lastMousePosition,t=e.velocityTime,o=e.setup,s=e.wrapperComponent,l=o.velocityAnimation.equalToMove,c=Date.now();if(n&&t&&s){var m=ir(s,l),p=r.x-n.x,d=r.y-n.y,h=p/m,y=d/m,S=c-t,P=p*p+d*d,Y=Math.sqrt(P)/S;e.velocity={velocityX:h,velocityY:y,total:Y}}e.lastMousePosition=r,e.velocityTime=c}}function rr(e){var r=e.velocity,i=e.bounds,n=e.setup,t=e.wrapperComponent,o=In(e);if(!(!o||!r||!i||!t)){var s=r.velocityX,l=r.velocityY,c=r.total,m=i.maxPositionX,p=i.minPositionX,d=i.maxPositionY,h=i.minPositionY,y=n.limitToBounds,S=n.alignmentAnimation,P=n.zoomAnimation,Y=n.panning,x=Y.lockAxisY,M=Y.lockAxisX,W=P.animationType,F=S.sizeX,C=S.sizeY,N=S.velocityAlignmentTime,O=N,B=er(e,c),V=Math.max(B,O),Z=ne(e,F),G=ne(e,C),K=Z*t.offsetWidth/100,ae=G*t.offsetHeight/100,ce=m+K,pe=p-K,fe=d+ae,me=h-ae,be=e.transformState,Se=new Date().getTime();Zi(e,W,V,function(Xe){var xe=e.transformState,k=xe.scale,J=xe.positionX,Ce=xe.positionY,we=new Date().getTime()-Se,L=we/O,Le=Li[S.animationType],ze=1-Le(Math.min(1,L)),te=1-Xe,oe=J+s*te,De=Ce+l*te,ve=Di(oe,be.positionX,J,M,y,p,m,pe,ce,ze),Ee=Di(De,be.positionY,Ce,x,y,h,d,me,fe,ze);(J!==oe||Ce!==De)&&e.setTransformState(k,ve,Ee)})}}function Ei(e,r){var i=e.transformState.scale;Q(e),ue(e,i),window.TouchEvent!==void 0&&r instanceof TouchEvent?qn(e,r):Qn(e,r)}function ri(e,r){var i=e.transformState.scale,n=e.setup,t=n.minScale,o=n.alignmentAnimation,s=o.disabled,l=o.sizeX,c=o.sizeY,m=o.animationTime,p=o.animationType,d=s||i<t||!l&&!c;if(!d){var h=Un(e);h&&re(e,h,r??m,p)}}function ki(e,r,i){var n=e.startCoords,t=e.setup,o=t.alignmentAnimation,s=o.sizeX,l=o.sizeY;if(n){var c=Gn(e,r,i),m=c.x,p=c.y,d=ne(e,s),h=ne(e,l);nr(e,{x:m,y:p}),Ri(e,m,p,d,h)}}function ar(e){if(e.isPanning){var r=e.setup.panning.velocityDisabled,i=e.velocity,n=e.wrapperComponent,t=e.contentComponent;e.isPanning=!1,e.animate=!1,e.animation=null;var o=n==null?void 0:n.getBoundingClientRect(),s=t==null?void 0:t.getBoundingClientRect(),l=(o==null?void 0:o.width)||0,c=(o==null?void 0:o.height)||0,m=(s==null?void 0:s.width)||0,p=(s==null?void 0:s.height)||0,d=l<m||c<p,h=!r&&i&&(i==null?void 0:i.total)>.1&&d;h?rr(e):ri(e)}}function ai(e,r,i,n){var t=e.setup,o=t.minScale,s=t.maxScale,l=t.limitToBounds,c=Ye($(r,2),o,s,0,!1),m=ue(e,c),p=Me(e,i,n,c,m,l),d=p.x,h=p.y;return{scale:c,positionX:d,positionY:h}}function Hi(e,r,i){var n=e.transformState.scale,t=e.wrapperComponent,o=e.setup,s=o.minScale,l=o.limitToBounds,c=o.zoomAnimation,m=c.disabled,p=c.animationTime,d=c.animationType,h=m||n>=s;if((n>=1||l)&&ri(e),!(h||!t||!e.mounted)){var y=r||t.offsetWidth/2,S=i||t.offsetHeight/2,P=ai(e,s,y,S);P&&re(e,P,p,d)}}var ee=function(){return ee=Object.assign||function(r){for(var i,n=1,t=arguments.length;n<t;n++){i=arguments[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(r[o]=i[o])}return r},ee.apply(this,arguments)};function Wi(e,r,i){for(var n=0,t=r.length,o;n<t;n++)(o||!(n in r))&&(o||(o=Array.prototype.slice.call(r,0,n)),o[n]=r[n]);return e.concat(o||Array.prototype.slice.call(r))}var Ne={scale:1,positionX:0,positionY:0},Ae={disabled:!1,minPositionX:null,maxPositionX:null,minPositionY:null,maxPositionY:null,minScale:1,maxScale:8,limitToBounds:!0,centerZoomedOut:!1,centerOnInit:!1,disablePadding:!1,smooth:!0,wheel:{step:.2,disabled:!1,smoothStep:.001,wheelDisabled:!1,touchPadDisabled:!1,activationKeys:[],excluded:[]},panning:{disabled:!1,velocityDisabled:!1,lockAxisX:!1,lockAxisY:!1,allowLeftClickPan:!0,allowMiddleClickPan:!0,allowRightClickPan:!0,wheelPanning:!1,activationKeys:[],excluded:[]},pinch:{step:5,disabled:!1,excluded:[]},doubleClick:{disabled:!1,step:.7,mode:"zoomIn",animationType:"easeOut",animationTime:200,excluded:[]},zoomAnimation:{disabled:!1,size:.4,animationTime:200,animationType:"easeOut"},alignmentAnimation:{disabled:!1,sizeX:100,sizeY:100,animationTime:200,velocityAlignmentTime:400,animationType:"easeOut"},velocityAnimation:{disabled:!1,sensitivity:1,animationTime:400,animationType:"easeOut",equalToMove:!0}},Ie={wrapperClass:"react-transform-wrapper",contentClass:"react-transform-component"},Fi=function(e){var r,i,n,t;return{previousScale:(r=e.initialScale)!==null&&r!==void 0?r:Ne.scale,scale:(i=e.initialScale)!==null&&i!==void 0?i:Ne.scale,positionX:(n=e.initialPositionX)!==null&&n!==void 0?n:Ne.positionX,positionY:(t=e.initialPositionY)!==null&&t!==void 0?t:Ne.positionY}},Ni=function(e){var r=ee({},Ae);return Object.keys(e).forEach(function(i){var n=typeof e[i]<"u",t=typeof Ae[i]<"u";if(t&&n){var o=Object.prototype.toString.call(Ae[i]),s=o==="[object Object]",l=o==="[object Array]";s?r[i]=ee(ee({},Ae[i]),e[i]):l?r[i]=Wi(Wi([],Ae[i],!0),e[i]):r[i]=e[i]}}),r},Vi=function(e,r,i){var n=e.transformState.scale,t=e.wrapperComponent,o=e.setup,s=o.maxScale,l=o.minScale,c=o.zoomAnimation,m=o.smooth,p=c.size;if(!t)throw new Error("Wrapper is not mounted");var d=m?n*Math.exp(r*i):n+r*i,h=Ye($(d,3),l,s,p,!1);return h};function $i(e,r,i,n,t){var o=e.wrapperComponent,s=e.transformState,l=s.scale,c=s.positionX,m=s.positionY;if(!o)return console.error("No WrapperComponent found");var p=o.offsetWidth,d=o.offsetHeight,h=(p/2-c)/l,y=(d/2-m)/l,S=Vi(e,r,i),P=ai(e,S,h,y);if(!P)return console.error("Error during zoom event. New transformation state was not calculated.");re(e,P,n,t)}function Ki(e,r,i,n){var t=e.setup,o=e.wrapperComponent,s=t.limitToBounds,l=Fi(e.props),c=e.transformState,m=c.scale,p=c.positionX,d=c.positionY;if(o){var h=ni(e,l.scale),y=Te(l.positionX,l.positionY,h,s,0,0,o),S={scale:l.scale,positionX:y.x,positionY:y.y};m===l.scale&&p===l.positionX&&d===l.positionY||(n==null||n(),re(e,S,r,i))}}function tr(e,r,i,n){var t=e.getBoundingClientRect(),o=r.getBoundingClientRect(),s=i.getBoundingClientRect(),l=o.x*n.scale,c=o.y*n.scale;return{x:(t.x-s.x+l)/n.scale,y:(t.y-s.y+c)/n.scale}}function or(e,r,i){var n=e.wrapperComponent,t=e.contentComponent,o=e.transformState,s=e.setup,l=s.limitToBounds,c=s.minScale,m=s.maxScale;if(!n||!t)return o;var p=n.getBoundingClientRect(),d=r.getBoundingClientRect(),h=tr(r,n,t,o),y=h.x,S=h.y,P=d.width/o.scale,Y=d.height/o.scale,x=n.offsetWidth/P,M=n.offsetHeight/Y,W=Ye(i||Math.min(x,M),c,m,0,!1),F=(p.width-P*W)/2,C=(p.height-Y*W)/2,N=(p.left-y)*W+F,O=(p.top-S)*W+C,B=ni(e,W),V=Te(N,O,B,l,0,0,n),Z=V.x,G=V.y;return{positionX:Z,positionY:G,scale:W}}var sr=function(e){return function(r,i,n){r===void 0&&(r=.5),i===void 0&&(i=300),n===void 0&&(n="easeOut"),$i(e,1,r,i,n)}},lr=function(e){return function(r,i,n){r===void 0&&(r=.5),i===void 0&&(i=300),n===void 0&&(n="easeOut"),$i(e,-1,r,i,n)}},dr=function(e){return function(r,i,n,t,o){t===void 0&&(t=300),o===void 0&&(o="easeOut");var s=e.transformState,l=s.positionX,c=s.positionY,m=s.scale,p=e.wrapperComponent,d=e.contentComponent,h=e.setup.disabled;if(!(h||!p||!d)){var y={positionX:Number.isNaN(r)?l:r,positionY:Number.isNaN(i)?c:i,scale:Number.isNaN(n)?m:n};re(e,y,t,o)}}},ur=function(e){return function(r,i){r===void 0&&(r=200),i===void 0&&(i="easeOut"),Ki(e,r,i)}},cr=function(e){return function(r,i,n){i===void 0&&(i=200),n===void 0&&(n="easeOut");var t=e.transformState,o=e.wrapperComponent,s=e.contentComponent;if(o&&s){var l=Qi(r||t.scale,o,s);re(e,l,i,n)}}},pr=function(e){return function(r,i,n,t){n===void 0&&(n=600),t===void 0&&(t="easeOut"),Q(e);var o=e.wrapperComponent,s=typeof r=="string"?document.getElementById(r):r;if(o&&s&&o.contains(s)){var l=or(e,s,i);re(e,l,n,t)}}},ei=function(e){return{instance:e,zoomIn:sr(e),zoomOut:lr(e),setTransform:dr(e),resetTransform:ur(e),centerView:cr(e),zoomToElement:pr(e)}},fr=function(e){return{instance:e,state:e.transformState}},D=function(e){var r={};return Object.assign(r,fr(e)),Object.assign(r,ei(e)),r},Ue=!1;function Ge(){try{var e={get passive(){return Ue=!0,!1}};return e}catch{return Ue=!1,Ue}}var _e=".".concat(Ie.wrapperClass),Be=function(e,r){return r.some(function(i){return e.matches("".concat(_e," ").concat(i,", ").concat(_e," .").concat(i,", ").concat(_e," ").concat(i," *, ").concat(_e," .").concat(i," *"))})},ii=function(e){e&&clearTimeout(e)},mr=function(e,r,i){return"translate(".concat(e,"px, ").concat(r,"px) scale(").concat(i,")")},Qi=function(e,r,i){var n=i.offsetWidth*e,t=i.offsetHeight*e,o=(r.offsetWidth-n)/2,s=(r.offsetHeight-t)/2;return{scale:e,positionX:o,positionY:s}};function vr(e){return function(r){e.forEach(function(i){typeof i=="function"?i(r):i!=null&&(i.current=r)})}}var hr=function(e,r){var i=e.setup.wheel,n=i.disabled,t=i.wheelDisabled,o=i.touchPadDisabled,s=i.excluded,l=e.isInitialized,c=e.isPanning,m=r.target,p=l&&!c&&!n&&m;if(!p||t&&!r.ctrlKey||o&&r.ctrlKey)return!1;var d=Be(m,s);return!d},gr=function(e){return e?e.deltaY<0?1:-1:0};function yr(e,r){var i=gr(e),n=zn(r,i);return n}function qi(e,r,i){var n=r.getBoundingClientRect(),t=0,o=0;if("clientX"in e)t=(e.clientX-n.left)/i,o=(e.clientY-n.top)/i;else{var s=e.touches[0];t=(s.clientX-n.left)/i,o=(s.clientY-n.top)/i}return(Number.isNaN(t)||Number.isNaN(o))&&console.error("No mouse or touch offset found"),{x:t,y:o}}var br=function(e,r,i,n,t){var o=e.transformState.scale,s=e.wrapperComponent,l=e.setup,c=l.maxScale,m=l.minScale,p=l.zoomAnimation,d=l.disablePadding,h=p.size,y=p.disabled;if(!s)throw new Error("Wrapper is not mounted");var S=o+r*i,P=n?!1:!y,Y=Ye($(S,3),m,c,h,P&&!d);return Y},Sr=function(e,r){var i=e.previousWheelEvent,n=e.transformState.scale,t=e.setup,o=t.maxScale,s=t.minScale;return i?n<o||n>s||Math.sign(i.deltaY)!==Math.sign(r.deltaY)||i.deltaY>0&&i.deltaY<r.deltaY||i.deltaY<0&&i.deltaY>r.deltaY||Math.sign(i.deltaY)!==Math.sign(r.deltaY):!1},xr=function(e,r){var i=e.setup.pinch,n=i.disabled,t=i.excluded,o=e.isInitialized,s=r.target,l=o&&!n&&s;if(!l)return!1;var c=Be(s,t);return!c},Cr=function(e){var r=e.setup.pinch.disabled,i=e.isInitialized,n=e.pinchStartDistance,t=i&&!r&&n;return!!t},wr=function(e,r,i){var n=i.getBoundingClientRect(),t=e.touches,o=$(t[0].clientX-n.left,5),s=$(t[0].clientY-n.top,5),l=$(t[1].clientX-n.left,5),c=$(t[1].clientY-n.top,5);return{x:(o+l)/2/r,y:(s+c)/2/r}},Ui=function(e){return Math.sqrt(Math.pow(e.touches[0].pageX-e.touches[1].pageX,2)+Math.pow(e.touches[0].pageY-e.touches[1].pageY,2))},jr=function(e,r){var i=e.pinchStartScale,n=e.pinchStartDistance,t=e.setup,o=t.maxScale,s=t.minScale,l=t.zoomAnimation,c=t.disablePadding,m=l.size,p=l.disabled;if(!i||n===null||!r)throw new Error("Pinch touches distance was not provided");if(r<0)return e.transformState.scale;var d=r/n,h=d*i;return Ye($(h,2),s,o,m,!p&&!c)},Pr=160,Ar=100,Tr=function(e,r){var i=e.props,n=i.onWheelStart,t=i.onZoomStart;e.wheelStopEventTimer||(Q(e),E(D(e),r,n),E(D(e),r,t))},Yr=function(e,r){var i=e.props,n=i.onWheel,t=i.onZoom,o=e.contentComponent,s=e.setup,l=e.transformState,c=l.scale,m=s.limitToBounds,p=s.centerZoomedOut,d=s.zoomAnimation,h=s.wheel,y=s.disablePadding,S=s.smooth,P=d.size,Y=d.disabled,x=h.step,M=h.smoothStep;if(!o)throw new Error("Component not mounted");r.preventDefault(),r.stopPropagation();var W=yr(r,null),F=S?M*Math.abs(r.deltaY):x,C=br(e,W,F,!r.ctrlKey);if(c!==C){var N=ue(e,C),O=qi(r,o,c),B=Y||P===0||p||y,V=m&&B,Z=Me(e,O.x,O.y,C,N,V),G=Z.x,K=Z.y;e.previousWheelEvent=r,e.setTransformState(C,G,K),E(D(e),r,n),E(D(e),r,t)}},Xr=function(e,r){var i=e.props,n=i.onWheelStop,t=i.onZoomStop;ii(e.wheelAnimationTimer),e.wheelAnimationTimer=setTimeout(function(){e.mounted&&(Hi(e,r.x,r.y),e.wheelAnimationTimer=null)},Ar);var o=Sr(e,r);o&&(ii(e.wheelStopEventTimer),e.wheelStopEventTimer=setTimeout(function(){e.mounted&&(e.wheelStopEventTimer=null,E(D(e),r,n),E(D(e),r,t))},Pr))},Gi=function(e){for(var r=0,i=0,n=0;n<2;n+=1)r+=e.touches[n].clientX,i+=e.touches[n].clientY;var t=r/2,o=i/2;return{x:t,y:o}},zr=function(e,r){var i=Ui(r);e.pinchStartDistance=i,e.lastDistance=i,e.pinchStartScale=e.transformState.scale,e.isPanning=!1;var n=Gi(r);e.pinchLastCenterX=n.x,e.pinchLastCenterY=n.y,Q(e)},Dr=function(e,r){var i=e.contentComponent,n=e.pinchStartDistance,t=e.wrapperComponent,o=e.transformState.scale,s=e.setup,l=s.limitToBounds,c=s.centerZoomedOut,m=s.zoomAnimation,p=s.alignmentAnimation,d=m.disabled,h=m.size;if(!(n===null||!i)){var y=wr(r,o,i);if(!(!Number.isFinite(y.x)||!Number.isFinite(y.y))){var S=Ui(r),P=jr(e,S),Y=Gi(r),x=Y.x-(e.pinchLastCenterX||0),M=Y.y-(e.pinchLastCenterY||0);if(!(P===o&&x===0&&M===0)){e.pinchLastCenterX=Y.x,e.pinchLastCenterY=Y.y;var W=ue(e,P),F=d||h===0||c,C=l&&F,N=Me(e,y.x,y.y,P,W,C),O=N.x,B=N.y;e.pinchMidpoint=y,e.lastDistance=S;var V=p.sizeX,Z=p.sizeY,G=ne(e,V),K=ne(e,Z),ae=O+x,ce=B+M,pe=Te(ae,ce,W,l,G,K,t),fe=pe.x,me=pe.y;e.setTransformState(P,fe,me)}}}},Er=function(e){var r=e.pinchMidpoint;e.velocity=null,e.lastDistance=null,e.pinchMidpoint=null,e.pinchStartScale=null,e.pinchStartDistance=null,Hi(e,r==null?void 0:r.x,r==null?void 0:r.y)},Ji=function(e,r){var i=e.props.onZoomStop,n=e.setup.doubleClick.animationTime;ii(e.doubleClickStopEventTimer),e.doubleClickStopEventTimer=setTimeout(function(){e.doubleClickStopEventTimer=null,E(D(e),r,i)},n)},kr=function(e,r){var i=e.props,n=i.onZoomStart,t=i.onZoom,o=e.setup.doubleClick,s=o.animationTime,l=o.animationType;E(D(e),r,n),Ki(e,s,l,function(){return E(D(e),r,t)}),Ji(e,r)};function Wr(e,r){return e==="toggle"?r===1?1:-1:e==="zoomOut"?-1:1}function Nr(e,r){var i=e.setup,n=e.doubleClickStopEventTimer,t=e.transformState,o=e.contentComponent,s=t.scale,l=e.props,c=l.onZoomStart,m=l.onZoom,p=i.doubleClick,d=p.disabled,h=p.mode,y=p.step,S=p.animationTime,P=p.animationType;if(!d&&!n){if(h==="reset")return kr(e,r);if(!o)return console.error("No ContentComponent found");var Y=Wr(h,e.transformState.scale),x=Vi(e,Y,y);if(s!==x){E(D(e),r,c);var M=qi(r,o,s),W=ai(e,x,M.x,M.y);if(!W)return console.error("Error during zoom event. New transformation state was not calculated.");E(D(e),r,m),re(e,W,S,P),Ji(e,r)}}}var _r=function(e,r){var i=e.isInitialized,n=e.setup,t=e.wrapperComponent,o=n.doubleClick,s=o.disabled,l=o.excluded,c=r.target,m=t==null?void 0:t.contains(c),p=i&&c&&m&&!s;if(!p)return!1;var d=Be(c,l);return!d},Mr=function(){function e(r){var i=this;this.mounted=!0,this.pinchLastCenterX=null,this.pinchLastCenterY=null,this.onChangeCallbacks=new Set,this.onInitCallbacks=new Set,this.wrapperComponent=null,this.contentComponent=null,this.isInitialized=!1,this.bounds=null,this.previousWheelEvent=null,this.wheelStopEventTimer=null,this.wheelAnimationTimer=null,this.isPanning=!1,this.isWheelPanning=!1,this.startCoords=null,this.lastTouch=null,this.distance=null,this.lastDistance=null,this.pinchStartDistance=null,this.pinchStartScale=null,this.pinchMidpoint=null,this.doubleClickStopEventTimer=null,this.velocity=null,this.velocityTime=null,this.lastMousePosition=null,this.animate=!1,this.animation=null,this.maxBounds=null,this.pressedKeys={},this.mount=function(){i.initializeWindowEvents()},this.unmount=function(){i.cleanupWindowEvents()},this.update=function(n){i.props=n,ue(i,i.transformState.scale),i.setup=Ni(n)},this.initializeWindowEvents=function(){var n,t,o=Ge(),s=(n=i.wrapperComponent)===null||n===void 0?void 0:n.ownerDocument,l=s==null?void 0:s.defaultView;(t=i.wrapperComponent)===null||t===void 0||t.addEventListener("wheel",i.onWheelPanning,o),l==null||l.addEventListener("mousedown",i.onPanningStart,o),l==null||l.addEventListener("mousemove",i.onPanning,o),l==null||l.addEventListener("mouseup",i.onPanningStop,o),s==null||s.addEventListener("mouseleave",i.clearPanning,o),l==null||l.addEventListener("keyup",i.setKeyUnPressed,o),l==null||l.addEventListener("keydown",i.setKeyPressed,o)},this.cleanupWindowEvents=function(){var n,t,o=Ge(),s=(n=i.wrapperComponent)===null||n===void 0?void 0:n.ownerDocument,l=s==null?void 0:s.defaultView;l==null||l.removeEventListener("mousedown",i.onPanningStart,o),l==null||l.removeEventListener("mousemove",i.onPanning,o),l==null||l.removeEventListener("mouseup",i.onPanningStop,o),s==null||s.removeEventListener("mouseleave",i.clearPanning,o),l==null||l.removeEventListener("keyup",i.setKeyUnPressed,o),l==null||l.removeEventListener("keydown",i.setKeyPressed,o),document.removeEventListener("mouseleave",i.clearPanning,o),Q(i),(t=i.observer)===null||t===void 0||t.disconnect()},this.handleInitializeWrapperEvents=function(n){var t=Ge();n.addEventListener("wheel",i.onWheelZoom,t),n.addEventListener("dblclick",i.onDoubleClick,t),n.addEventListener("touchstart",i.onTouchPanningStart,t),n.addEventListener("touchmove",i.onTouchPanning,t),n.addEventListener("touchend",i.onTouchPanningStop,t)},this.handleInitialize=function(n,t){var o=!1,s=i.setup.centerOnInit,l=function(c,m){for(var p=0,d=c;p<d.length;p++){var h=d[p];if(h.target===m)return!0}return!1};i.applyTransformation(),i.onInitCallbacks.forEach(function(c){c(D(i))}),i.observer=new ResizeObserver(function(c){if(l(c,n)||l(c,t))if(s&&!o){var m=t.offsetWidth,p=t.offsetHeight;(m>0||p>0)&&(o=!0,i.setCenter())}else Q(i),ue(i,i.transformState.scale),ri(i,0)}),i.observer.observe(n),i.observer.observe(t)},this.onWheelZoom=function(n){var t=i.setup.disabled;if(!t){var o=hr(i,n);if(o){var s=i.isPressingKeys(i.setup.wheel.activationKeys);s&&(Tr(i,n),Yr(i,n),Xr(i,n))}}},this.onWheelPanning=function(n){var t=i.setup,o=t.disabled,s=t.wheel,l=t.panning;if(!(!i.wrapperComponent||!i.contentComponent||o||!s.wheelDisabled||l.disabled||!l.wheelPanning||n.ctrlKey)){n.preventDefault(),n.stopPropagation();var c=i.transformState,m=c.positionX,p=c.positionY,d=m-n.deltaX,h=p-n.deltaY,y=l.lockAxisX?m:d,S=l.lockAxisY?p:h,P=i.setup.alignmentAnimation,Y=P.sizeX,x=P.sizeY,M=ne(i,Y),W=ne(i,x);y===m&&S===p||Ri(i,y,S,M,W)}},this.onPanningStart=function(n){var t=i.setup.disabled,o=i.props.onPanningStart;if(!t){var s=Xi(i,n);if(s){var l=i.isPressingKeys(i.setup.panning.activationKeys);l&&(n.button===0&&!i.setup.panning.allowLeftClickPan||n.button===1&&!i.setup.panning.allowMiddleClickPan||n.button===2&&!i.setup.panning.allowRightClickPan||(n.preventDefault(),n.stopPropagation(),Q(i),Ei(i,n),E(D(i),n,o)))}}},this.onPanning=function(n){var t=i.setup.disabled,o=i.props.onPanning;if(!t){var s=zi(i);if(s){var l=i.isPressingKeys(i.setup.panning.activationKeys);l&&(n.preventDefault(),n.stopPropagation(),ki(i,n.clientX,n.clientY),E(D(i),n,o))}}},this.onPanningStop=function(n){var t=i.props.onPanningStop;i.isPanning&&(ar(i),E(D(i),n,t))},this.onPinchStart=function(n){var t=i.setup.disabled,o=i.props,s=o.onPinchingStart,l=o.onZoomStart;if(!t){var c=xr(i,n);c&&(zr(i,n),Q(i),E(D(i),n,s),E(D(i),n,l))}},this.onPinch=function(n){var t=i.setup.disabled,o=i.props,s=o.onPinching,l=o.onZoom;if(!t){var c=Cr(i);c&&(n.preventDefault(),n.stopPropagation(),Dr(i,n),E(D(i),n,s),E(D(i),n,l))}},this.onPinchStop=function(n){var t=i.props,o=t.onPinchingStop,s=t.onZoomStop;i.pinchStartScale&&(Er(i),E(D(i),n,o),E(D(i),n,s))},this.onTouchPanningStart=function(n){var t=i.setup.disabled,o=i.props.onPanningStart;if(!t){var s=Xi(i,n);if(s){var l=i.lastTouch&&+new Date-i.lastTouch<200&&n.touches.length===1;if(!l){i.lastTouch=+new Date,Q(i);var c=n.touches,m=c.length===1,p=c.length===2;m&&(Q(i),Ei(i,n),E(D(i),n,o)),p&&i.onPinchStart(n)}}}},this.onTouchPanning=function(n){var t=i.setup.disabled,o=i.props.onPanning;if(i.isPanning&&n.touches.length===1){if(t)return;var s=zi(i);if(!s)return;n.preventDefault(),n.stopPropagation();var l=n.touches[0];ki(i,l.clientX,l.clientY),E(D(i),n,o)}else n.touches.length>1&&i.onPinch(n)},this.onTouchPanningStop=function(n){i.onPanningStop(n),i.onPinchStop(n)},this.onDoubleClick=function(n){var t=i.setup.disabled;if(!t){var o=_r(i,n);o&&Nr(i,n)}},this.clearPanning=function(n){i.isPanning&&i.onPanningStop(n)},this.setKeyPressed=function(n){i.pressedKeys[n.key]=!0},this.setKeyUnPressed=function(n){i.pressedKeys[n.key]=!1},this.isPressingKeys=function(n){return n.length?!!n.find(function(t){return i.pressedKeys[t]}):!0},this.setTransformState=function(n,t,o){var s=i.props.onTransformed;if(!Number.isNaN(n)&&!Number.isNaN(t)&&!Number.isNaN(o)){n!==i.transformState.scale&&(i.transformState.previousScale=i.transformState.scale,i.transformState.scale=n),i.transformState.positionX=t,i.transformState.positionY=o,i.applyTransformation();var l=D(i);i.onChangeCallbacks.forEach(function(c){return c(l)}),E(l,{scale:n,positionX:t,positionY:o},s)}else console.error("Detected NaN set state values")},this.setCenter=function(){if(i.wrapperComponent&&i.contentComponent){var n=Qi(i.transformState.scale,i.wrapperComponent,i.contentComponent);i.setTransformState(n.scale,n.positionX,n.positionY)}},this.handleTransformStyles=function(n,t,o){return i.props.customTransform?i.props.customTransform(n,t,o):mr(n,t,o)},this.applyTransformation=function(){if(!(!i.mounted||!i.contentComponent)){var n=i.transformState,t=n.scale,o=n.positionX,s=n.positionY,l=i.handleTransformStyles(o,s,t);i.contentComponent.style.transform=l}},this.getContext=function(){return D(i)},this.onChange=function(n){return i.onChangeCallbacks.has(n)||i.onChangeCallbacks.add(n),function(){i.onChangeCallbacks.delete(n)}},this.onInit=function(n){return i.onInitCallbacks.has(n)||i.onInitCallbacks.add(n),function(){i.onInitCallbacks.delete(n)}},this.init=function(n,t){i.cleanupWindowEvents(),i.wrapperComponent=n,i.contentComponent=t,ue(i,i.transformState.scale),i.handleInitializeWrapperEvents(n),i.handleInitialize(n,t),i.initializeWindowEvents(),i.isInitialized=!0;var o=D(i);E(o,void 0,i.props.onInit)},this.props=r,this.setup=Ni(this.props),this.transformState=Fi(this.props)}return e}(),ti=ie.createContext(null),Br=function(e,r){return typeof e=="function"?e(r):e},Lr=ie.forwardRef(function(e,r){var i=T.useRef(new Mr(e)).current,n=Br(e.children,ei(i));return T.useImperativeHandle(r,function(){return ei(i)},[i]),T.useEffect(function(){i.update(e)},[i,e]),ie.createElement(ti.Provider,{value:i},n)});ie.forwardRef(function(e,r){var i=T.useRef(null),n=T.useContext(ti);return T.useEffect(function(){return n.onChange(function(t){if(i.current){var o=0,s=0;i.current.style.transform=n.handleTransformStyles(o,s,1/t.instance.transformState.scale)}})},[n]),ie.createElement("div",ee({},e,{ref:vr([i,r])}))});function Or(e,r){r===void 0&&(r={});var i=r.insertAt;if(!(typeof document>"u")){var n=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",i==="top"&&n.firstChild?n.insertBefore(t,n.firstChild):n.appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}}var Zr=`.transform-component-module_wrapper__SPB86 {
  position: relative;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  overflow: hidden;
  -webkit-touch-callout: none; /* iOS Safari */
  -webkit-user-select: none; /* Safari */
  -khtml-user-select: none; /* Konqueror HTML */
  -moz-user-select: none; /* Firefox */
  -ms-user-select: none; /* Internet Explorer/Edge */
  user-select: none;
  margin: 0;
  padding: 0;
  transform: translate3d(0, 0, 0);
}
.transform-component-module_content__FBWxo {
  display: flex;
  flex-wrap: wrap;
  width: -moz-fit-content;
  width: fit-content;
  height: -moz-fit-content;
  height: fit-content;
  margin: 0;
  padding: 0;
  transform-origin: 0% 0%;
}
.transform-component-module_content__FBWxo img {
  pointer-events: none;
}
`,_i={wrapper:"transform-component-module_wrapper__SPB86",content:"transform-component-module_content__FBWxo"};Or(Zr);var Rr=function(e){var r=e.children,i=e.wrapperClass,n=i===void 0?"":i,t=e.contentClass,o=t===void 0?"":t,s=e.wrapperStyle,l=e.contentStyle,c=e.wrapperProps,m=c===void 0?{}:c,p=e.contentProps,d=p===void 0?{}:p,h=T.useContext(ti),y=h.init,S=h.cleanupWindowEvents,P=T.useRef(null),Y=T.useRef(null);return T.useEffect(function(){var x=P.current,M=Y.current;return x!==null&&M!==null&&y&&(y==null||y(x,M)),function(){S==null||S()}},[]),ie.createElement("div",ee({},m,{ref:P,className:"".concat(Ie.wrapperClass," ").concat(_i.wrapper," ").concat(n),style:s}),ie.createElement("div",ee({},d,{ref:Y,className:"".concat(Ie.contentClass," ").concat(_i.content," ").concat(o),style:l}),r))},oi={},Hr=Mi;Object.defineProperty(oi,"__esModule",{value:!0});var Ii=oi.default=void 0,Fr=Hr(Bi()),Vr=a;Ii=oi.default=(0,Fr.default)((0,Vr.jsx)("path",{d:"m5 9 1.41 1.41L11 5.83V22h2V5.83l4.59 4.59L19 9l-7-7z"}),"North");var si={},$r=Mi;Object.defineProperty(si,"__esModule",{value:!0});var en=si.default=void 0,Kr=$r(Bi()),Qr=a;en=si.default=(0,Kr.default)((0,Qr.jsx)("path",{d:"m21.9 21.9-8.49-8.49-9.82-9.82L2.1 2.1.69 3.51 3 5.83V19c0 1.1.9 2 2 2h13.17l2.31 2.31zM5 18l3.5-4.5 2.5 3.01L12.17 15l3 3zm16 .17L5.83 3H19c1.1 0 2 .9 2 2z"}),"ImageNotSupported");const ea=()=>{const e=Tn(),r=z(u=>u.locations),i=z(u=>u.playTrack);z(u=>u.stopTrack);const n=z(u=>u.getSublocationsByParentId),t=z(u=>u.getAllTopLevelLocations),o=z(u=>u.refreshAssets);z(u=>u.hasAssets);const s=z(u=>u.isLoading),l=z(u=>u.characters),c=z(u=>u.combats);z(u=>u.saveDataToIndexedDB);const m=z(u=>u.selectedLocationId),p=z(u=>u.setSelectedLocationId),[d,h]=T.useState(null),[y,S]=T.useState(!1),[P,Y]=T.useState(!1),[x,M]=T.useState(!1),[W,F]=T.useState(!1),[C,N]=T.useState(null),[O,B]=T.useState(!1),V=T.useRef(null),Z=T.useRef(null),[G,K]=T.useState(!1),[ae,ce]=T.useState([]),[pe,fe]=T.useState([]),me=r.length>0,[be,Se]=T.useState(""),[Xe,xe]=T.useState({}),[k,J]=T.useState(null),[Ce,we]=T.useState(!1),[L,Le]=T.useState(null),[ze,te]=T.useState(!1),[oe,De]=T.useState(0);T.useEffect(()=>{if(r.length>0)if(m){const u=r.find(f=>f.id===m);if(u)h(u),S(!0);else{const f=t();f.length>0&&(h(f[0]),p(f[0].id))}}else{const u=t();u.length>0&&(h(u[0]),p(u[0].id))}},[r,m]),T.useEffect(()=>{d&&((async()=>{K(!0);try{if(d.imageUrl){const f=await We.getAssetUrl("images",d.imageUrl);Se(f)}else Se("")}catch(f){console.error("Error loading image:",f),Se("")}finally{K(!1)}})(),p(d.id))},[d==null?void 0:d.id,d==null?void 0:d.imageUrl]),T.useEffect(()=>{if(O){const u=async()=>{try{const v=await We.getAssets("audio");ce(v.map(g=>g.name))}catch(v){console.error("Failed to load audio assets:",v),ce([])}},f=async()=>{try{const v=await We.getAssets("images");fe(v.map(g=>g.name))}catch(v){console.error("Failed to load image assets:",v),fe([])}};u(),f()}},[O]);const ve=async(u,f)=>{if(f.stopPropagation(),x){N(u),B(!0);return}if((d==null?void 0:d.id)!==u.id){if(h(u),S(!0),u.entrySound){const v=await We.getAssetUrl("audio",u.entrySound);v&&new Xn.Howl({src:[v],loop:!1,volume:z.getState().volume}).play()}if(u.backgroundMusic){const v=`/audio/${u.backgroundMusic}`,w=!(!!u.parentLocationId&&u.mixWithParent===!0);i(v,{replace:w,locationId:u.id})}}else S(!y)},Ee=async()=>{if(await o(),d){const u=d.id;h(null),setTimeout(()=>{const f=r.find(v=>v.id===u);f&&h(f)},100)}},nn=u=>{if(!x||!d||!V.current||!Z.current)return;const f=Z.current.getBoundingClientRect(),v=(u.clientX-f.left)/f.width,g=(u.clientY-f.top)/f.height,w={name:"New Location",description:"Add a description",coordinates:[v,g],parentLocationId:d.id},_=z.getState().addLocation;_(w),z.getState().saveDataToIndexedDB()},rn=(u,f)=>{if(!x)return;const v=new Image;v.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",f.dataTransfer.setDragImage(v,0,0),f.dataTransfer.setData("locationId",u),F(!0)},an=u=>{x&&u.preventDefault()},tn=u=>{if(!x||!V.current||!Z.current)return;u.preventDefault();const f=u.dataTransfer.getData("locationId");if(!f||!z.getState().locations.find(se=>se.id===f))return;const w=Z.current.getBoundingClientRect(),_=(u.clientX-w.left)/w.width,b=(u.clientY-w.top)/w.height,X=z.getState().updateLocation;X(f,{coordinates:[_,b]}),z.getState().saveDataToIndexedDB(),F(!1)},on=()=>{M(!x),O&&(B(!1),N(null))},sn=()=>d?n(d.id).map(f=>{if(!f.coordinates)return null;const[v,g]=f.coordinates,w=(d==null?void 0:d.id)===f.id;return a.jsx(Pi,{title:x?"Drag to move, click to edit":f.name,arrow:!0,placement:"top",children:a.jsxs(j,{sx:{position:"absolute",left:`${v*100}%`,top:`${g*100}%`,transform:"translate(-50%, -50%)",zIndex:5,cursor:x?"move":"pointer",transition:"all 0.2s ease-in-out","&:hover":{transform:"translate(-50%, -50%) scale(1.2)"}},onClick:_=>ve(f,_),draggable:x,onDragStart:_=>rn(f.id,_),children:[a.jsx(He,{color:w?"primary":x?"secondary":"error",sx:{fontSize:w?"2.5rem":"2rem",filter:"drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.9))"}}),a.jsx(A,{variant:"caption",sx:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",whiteSpace:"nowrap",backgroundColor:"rgba(0, 0, 0, 0.7)",color:"white",padding:"2px 6px",borderRadius:"4px",fontSize:"0.7rem",fontWeight:"bold",textAlign:"center",maxWidth:"120px",overflow:"hidden",textOverflow:"ellipsis",filter:"drop-shadow(0px 0px 2px rgba(0, 0, 0, 0.5))"},children:f.name})]})},f.id)}):null,li=(u,f=0)=>{const v=n(u.id),g=v.length>0;return a.jsxs(ie.Fragment,{children:[a.jsx(R,{disablePadding:!0,sx:{pl:f*2},children:a.jsxs(An,{selected:(d==null?void 0:d.id)===u.id,onClick:w=>ve(u,w),children:[a.jsx(de,{sx:{minWidth:36},children:a.jsx(He,{})}),a.jsx(H,{primary:u.name}),g&&a.jsx(U,{size:"small"})]})}),g&&a.jsx(Ke,{in:(d==null?void 0:d.id)===u.id,timeout:"auto",unmountOnExit:!0,children:a.jsx(q,{disablePadding:!0,children:v.map(w=>li(w,f+1))})})]},u.id)},ln=()=>{if(!d)return null;z.getState().mapConfig.worldWidth,z.getState().mapConfig.worldHeight;const u=.3;return r.filter(f=>{var v;return((v=d.connectedLocations)==null?void 0:v.includes(f.id))&&f.id!==d.id}).map(f=>{if(!d.coordinates||!f.coordinates)return null;const[v,g]=d.coordinates,[w,_]=f.coordinates,b=w-v,X=_-g,je=Math.atan2(X,b)*(180/Math.PI)+90,Ze=Math.sqrt(b*b+X*X),fn=b/Ze,mn=X/Ze,vn=.5,hn=.5,gn=vn+fn*u,yn=hn+mn*u;return a.jsx(Pi,{title:`${f.name} (${Ze.toFixed(1)} meters)`,placement:"top",arrow:!0,children:a.jsx(U,{onClick:hi=>{hi.stopPropagation(),ve(f,hi)},sx:{position:"absolute",zIndex:10,color:"white",backgroundColor:"rgba(0,0,0,0.5)","&:hover":{backgroundColor:"rgba(0,0,0,0.8)"},left:`${gn*100}%`,top:`${yn*100}%`,transform:"translate(-50%, -50%)"},children:a.jsx(Ii,{fontSize:"large",sx:{transform:`rotate(${je}deg)`}})})},`tooltip-${f.id}`)})},di=u=>{xe(f=>({...f,[u]:!f[u]}))},Oe=u=>l.filter(f=>f.locationId===u),ui=u=>{const f=Oe(u),v=n(u);let g=[...f];return v.forEach(w=>{const _=ui(w.id);g=[...g,..._]}),g},ci=(u,f)=>{f.stopPropagation(),J(u),we(!0)},dn=()=>{if(!d)return null;const u=Oe(d.id),f=ui(d.id),v=f.length>u.length;return f.length===0?a.jsx(j,{sx:{p:2},children:a.jsx(A,{variant:"body2",color:"text.secondary",children:"No NPCs in this location"})}):a.jsx(j,{children:a.jsxs(q,{dense:!0,children:[u.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(R,{children:a.jsx(H,{primary:`NPCs in ${d.name}`,primaryTypographyProps:{variant:"subtitle1",fontWeight:"bold"}})}),u.map(g=>a.jsxs(R,{button:!0,onClick:w=>ci(g,w),sx:{cursor:"pointer"},children:[a.jsx(de,{children:g.type==="npc"?a.jsx(Qe,{fontSize:"small"}):g.type==="merchant"?a.jsx(ji,{fontSize:"small"}):a.jsx(ye,{color:"error",fontSize:"small"})}),a.jsx(H,{primary:g.name,secondary:g.description})]},g.id)),v&&a.jsx(ge,{sx:{my:1}})]}),v&&pi(d.id)]})})},pi=u=>{const f=n(u);return a.jsx(a.Fragment,{children:f.map(v=>{const g=Oe(v.id);if(g.length===0)return null;const w=`npc-section-${v.id}`,_=Xe[w]||!1;return a.jsxs(j,{children:[a.jsxs(R,{button:!0,onClick:()=>di(w),sx:{pl:2},children:[a.jsx(H,{primary:v.name,primaryTypographyProps:{variant:"subtitle2"}}),_?a.jsx(Ai,{}):a.jsx(Ti,{})]}),a.jsx(Ke,{in:_,timeout:"auto",unmountOnExit:!0,children:a.jsx(q,{component:"div",disablePadding:!0,children:g.map(b=>a.jsxs(R,{button:!0,onClick:X=>ci(b,X),sx:{pl:4,cursor:"pointer"},children:[a.jsx(de,{children:b.type==="npc"?a.jsx(Qe,{fontSize:"small"}):b.type==="merchant"?a.jsx(ji,{fontSize:"small"}):a.jsx(ye,{color:"error",fontSize:"small"})}),a.jsx(H,{primary:b.name})]},b.id))})}),pi(v.id)]},v.id)})})},un=()=>{var _;if(!k)return null;const u=((_=r.find(b=>b.id===k.locationId))==null?void 0:_.name)||"Unknown",f=z.getState().updateCharacter,v=()=>{if(!k||!x)return;const b={id:crypto.randomUUID(),name:"New Item",description:"Item description",quantity:1},X=[...k.inventory||[],b];f(k.id,{inventory:X}),J({...k,inventory:X})},g=(b,X)=>{if(!k||!x)return;const se=(k.inventory||[]).map(je=>je.id===b?{...je,...X}:je);f(k.id,{inventory:se}),J({...k,inventory:se})},w=b=>{if(!k||!x)return;const X=(k.inventory||[]).filter(se=>se.id!==b);f(k.id,{inventory:X}),J({...k,inventory:X})};return a.jsxs(j,{sx:{p:2,minWidth:300,maxWidth:400},children:[a.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(A,{variant:"h6",children:k.name}),a.jsx(U,{onClick:()=>we(!1),size:"small",children:a.jsx(qe,{})})]}),a.jsx(A,{variant:"subtitle1",color:"text.secondary",children:k.type==="npc"?"NPC":k.type==="merchant"?"Merchant":"Enemy"}),a.jsx(A,{variant:"body2",paragraph:!0,children:k.description}),a.jsxs(j,{sx:{mb:2},children:[a.jsx(A,{variant:"subtitle2",children:"Location:"}),a.jsx(A,{variant:"body2",children:u})]}),a.jsx(ge,{sx:{my:2}}),a.jsxs(j,{sx:{mb:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(A,{variant:"h6",children:"Inventory"}),x&&a.jsx(U,{size:"small",onClick:v,color:"primary",children:a.jsx(Yn,{})})]}),!k.inventory||k.inventory.length===0?a.jsx(A,{variant:"body2",color:"text.secondary",children:"No items in inventory"}):a.jsx(q,{dense:!0,children:k.inventory.map(b=>a.jsx(R,{secondaryAction:x?a.jsx(U,{edge:"end",size:"small",onClick:()=>w(b.id),children:a.jsx(wi,{fontSize:"small"})}):null,children:a.jsx(H,{primary:x?a.jsx(I,{size:"small",value:b.name,onChange:X=>g(b.id,{name:X.target.value}),fullWidth:!0,variant:"standard",margin:"dense"}):b.name,secondary:a.jsxs(a.Fragment,{children:[x?a.jsx(I,{size:"small",value:b.description,onChange:X=>g(b.id,{description:X.target.value}),fullWidth:!0,variant:"standard",margin:"dense",multiline:!0}):b.description,a.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",mt:1},children:[a.jsxs(j,{children:["Qty: ",x?a.jsx(I,{size:"small",type:"number",value:b.quantity,onChange:X=>g(b.id,{quantity:parseInt(X.target.value)||0}),variant:"standard",sx:{width:50}}):b.quantity]}),b.price!==void 0&&a.jsxs(j,{children:["Price: ",x?a.jsx(I,{size:"small",type:"number",value:b.price,onChange:X=>g(b.id,{price:parseInt(X.target.value)||0}),variant:"standard",sx:{width:60}}):b.price]}),x&&b.price===void 0&&a.jsx(le,{size:"small",onClick:()=>g(b.id,{price:0}),children:"Add Price"})]})]})})},b.id))})]})},fi=u=>{const f=c.filter(w=>w.locationId===u),v=n(u);let g=[...f];return v.forEach(w=>{const _=fi(w.id);g=[...g,..._]}),g},mi=(u,f)=>{f.stopPropagation(),Le(u),te(!0)},cn=()=>{if(!d)return null;const u=c.filter(g=>g.locationId===d.id),f=fi(d.id),v=f.length>u.length;return f.length===0?a.jsx(j,{sx:{p:2},children:a.jsx(A,{variant:"body2",color:"text.secondary",children:"No combats in this location"})}):a.jsx(j,{children:a.jsxs(q,{dense:!0,children:[u.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(R,{children:a.jsx(H,{primary:`Combats in ${d.name}`,primaryTypographyProps:{variant:"subtitle1",fontWeight:"bold"}})}),u.map(g=>a.jsxs(R,{button:!0,onClick:w=>mi(g,w),sx:{cursor:"pointer"},children:[a.jsx(de,{children:a.jsx(ye,{color:"primary",fontSize:"small"})}),a.jsx(H,{primary:g.name,secondary:`Difficulty: ${g.difficulty||"Medium"}`})]},g.id)),v&&a.jsx(ge,{sx:{my:1}})]}),v&&vi(d.id)]})})},vi=u=>{const f=n(u);return a.jsx(a.Fragment,{children:f.map(v=>{const g=c.filter(b=>b.locationId===v.id);if(g.length===0)return null;const w=`combat-section-${v.id}`,_=Xe[w]||!1;return a.jsxs(j,{children:[a.jsxs(R,{button:!0,onClick:()=>di(w),sx:{pl:2},children:[a.jsx(H,{primary:v.name,primaryTypographyProps:{variant:"subtitle2"}}),_?a.jsx(Ai,{}):a.jsx(Ti,{})]}),a.jsx(Ke,{in:_,timeout:"auto",unmountOnExit:!0,children:a.jsx(q,{component:"div",disablePadding:!0,children:g.map(b=>a.jsxs(R,{button:!0,onClick:X=>mi(b,X),sx:{pl:4,cursor:"pointer"},children:[a.jsx(de,{children:a.jsx(ye,{color:"primary",fontSize:"small"})}),a.jsx(H,{primary:b.name,secondary:`Difficulty: ${b.difficulty||"Medium"}`})]},b.id))})}),vi(v.id)]},v.id)})})},pn=()=>{var f;if(!L)return null;const u=((f=r.find(v=>v.id===L.locationId))==null?void 0:f.name)||"Unknown";return a.jsxs(j,{sx:{p:2,minWidth:300,maxWidth:400},children:[a.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(A,{variant:"h6",children:L.name}),a.jsx(U,{onClick:()=>te(!1),size:"small",children:a.jsx(qe,{})})]}),a.jsxs(A,{variant:"subtitle1",color:"text.secondary",children:["Difficulty: ",L.difficulty||"Medium"]}),a.jsx(A,{variant:"body2",paragraph:!0,children:L.description}),a.jsxs(j,{sx:{mb:2},children:[a.jsx(A,{variant:"subtitle2",children:"Location:"}),a.jsx(A,{variant:"body2",children:u})]}),a.jsx(le,{variant:"contained",color:"primary",fullWidth:!0,startIcon:a.jsx(ye,{}),onClick:()=>{te(!1),e("/combat-session",{state:{combatId:L.id}})},sx:{mb:3},children:"Start Combat"}),a.jsx(ge,{sx:{my:2}}),a.jsx(A,{variant:"subtitle2",children:"Player Characters:"}),L.playerCharacters.length===0?a.jsx(A,{variant:"body2",color:"text.secondary",children:"No player characters assigned"}):a.jsx(q,{dense:!0,children:L.playerCharacters.map(v=>a.jsxs(R,{children:[a.jsx(de,{children:a.jsx(Qe,{fontSize:"small"})}),a.jsx(H,{primary:v.name})]},v.id))}),a.jsx(ge,{sx:{my:2}}),a.jsx(A,{variant:"subtitle2",children:"Enemies:"}),L.enemies.length===0?a.jsx(A,{variant:"body2",color:"text.secondary",children:"No enemies assigned"}):a.jsx(q,{dense:!0,children:Object.entries(L.enemies.reduce((v,g)=>(v[g.id]=v[g.id]||{enemy:g,count:0},v[g.id].count++,v),{})).map(([v,{enemy:g,count:w}])=>a.jsxs(R,{children:[a.jsx(de,{children:a.jsx(ye,{color:"error",fontSize:"small"})}),a.jsx(H,{primary:`${g.name} ${w>1?`(x${w})`:""}`,secondary:`HP: ${g.hp}`})]},v))}),L.rewards&&L.rewards.length>0&&a.jsxs(a.Fragment,{children:[a.jsx(ge,{sx:{my:2}}),a.jsx(A,{variant:"subtitle2",children:"Rewards:"}),a.jsx(q,{dense:!0,children:L.rewards.map(v=>a.jsx(R,{children:a.jsx(H,{primary:v.name,secondary:`Quantity: ${v.quantity}`})},v.id))})]})]})};return s?a.jsxs(j,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"background.default"},children:[a.jsx(gi,{size:60}),a.jsx(A,{variant:"h6",sx:{mt:2},children:"Loading your campaign..."})]}):me?a.jsxs(j,{sx:{display:"flex",height:"100%",overflow:"hidden"},children:[a.jsxs(yi,{elevation:3,sx:{width:280,height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",zIndex:1},children:[a.jsxs(bi,{value:y?1:0,onChange:(u,f)=>S(f===1),variant:"fullWidth",children:[a.jsx(Pe,{label:"Locations"}),a.jsx(Pe,{label:"Details",disabled:!d})]}),y?a.jsxs(j,{sx:{flexGrow:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[a.jsxs(j,{sx:{p:2,borderBottom:"1px solid rgba(0, 0, 0, 0.12)"},children:[a.jsxs(j,{sx:{display:"flex",alignItems:"center",mb:1},children:[a.jsx(U,{size:"small",onClick:()=>S(!1),sx:{mr:1},children:a.jsx(bn,{fontSize:"small"})}),a.jsx(A,{variant:"h6",noWrap:!0,children:d==null?void 0:d.name}),x&&a.jsx(U,{size:"small",color:"primary",onClick:()=>{d&&(N(d),B(!0))},sx:{ml:"auto"},children:a.jsx(Sn,{fontSize:"small"})})]}),(d==null?void 0:d.description)&&a.jsx(A,{variant:"body2",color:"text.secondary",children:d.description})]}),a.jsxs(j,{sx:{overflow:"auto",flexGrow:1},children:[a.jsxs(bi,{value:oe,onChange:(u,f)=>De(f),variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:[a.jsx(Pe,{label:"Info"}),a.jsx(Pe,{label:"NPCs"}),a.jsx(Pe,{label:"Combats"})]}),oe===0&&a.jsxs(j,{sx:{p:2},children:[(d==null?void 0:d.backgroundMusic)&&a.jsxs(j,{sx:{mb:2},children:[a.jsx(A,{variant:"subtitle2",children:"Background Music:"}),a.jsx(Re,{icon:a.jsx(Si,{}),label:d.backgroundMusic,size:"small",color:"primary",variant:"outlined",onClick:()=>{d!=null&&d.backgroundMusic&&i(d.backgroundMusic,{replace:!0,locationId:d.id,loop:!0})}})]}),(d==null?void 0:d.entrySound)&&a.jsxs(j,{sx:{mb:2},children:[a.jsx(A,{variant:"subtitle2",children:"Entry Sound:"}),a.jsx(Re,{icon:a.jsx(Si,{}),label:d.entrySound,size:"small",color:"secondary",variant:"outlined",onClick:()=>{d!=null&&d.entrySound&&i(d.entrySound,{replace:!1,locationId:d.id})}})]}),(d==null?void 0:d.connectedLocations)&&d.connectedLocations.length>0&&a.jsxs(j,{sx:{mb:2},children:[a.jsx(A,{variant:"subtitle2",children:"Connected Locations:"}),a.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:1,mt:1},children:d.connectedLocations.map(u=>{const f=r.find(v=>v.id===u);return f?a.jsx(Re,{icon:a.jsx(He,{}),label:f.name,size:"small",color:"info",variant:"outlined",onClick:()=>ve(f,{})},u):null})})]})]}),oe===1&&dn(),oe===2&&cn()]})]}):a.jsx(q,{sx:{overflowY:"auto",flexGrow:1,"& .MuiListItemButton-root.Mui-selected":{bgcolor:"primary.light","&:hover":{bgcolor:"primary.light"}}},children:t().map(u=>li(u))})]}),a.jsxs(j,{ref:Z,sx:{position:"relative",flex:1,height:"100%",overflow:"hidden",backgroundColor:"black",zIndex:1},onDragOver:an,onDrop:tn,onClick:nn,children:[s?a.jsxs(j,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.2)"},children:[a.jsx(gi,{size:60}),a.jsx(A,{variant:"body1",sx:{mt:2},children:"Loading map..."})]}):!be||!d?a.jsxs(j,{sx:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"rgba(0, 0, 0, 0.1)"},children:[a.jsx(en,{sx:{fontSize:60,opacity:.7}}),a.jsx(A,{variant:"body1",sx:{mt:2,opacity:.7},children:"No map image available"})]}):a.jsx(Lr,{initialScale:1,initialPositionX:0,initialPositionY:0,minScale:.5,maxScale:5,wheel:{step:.1},limitToBounds:!1,disablePadding:!0,disabled:x,children:()=>a.jsx(a.Fragment,{children:a.jsx(Rr,{wrapperStyle:{width:"100%",height:"100%",position:"absolute",top:0,left:0,zIndex:0},contentStyle:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:a.jsxs(j,{sx:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},children:[a.jsx("img",{ref:V,src:be,alt:(d==null?void 0:d.name)||"Map",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",position:"relative",zIndex:1},onLoad:()=>K(!1),onError:()=>K(!1)}),sn(),ln()]})})})},"main-map"),!me&&!s&&a.jsx(j,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10},children:a.jsxs(j,{sx:{textAlign:"center",maxWidth:400,p:3,bgcolor:"rgba(0,0,0,0.8)",color:"white",borderRadius:2},children:[a.jsx(A,{variant:"h5",gutterBottom:!0,children:"No locations found"}),a.jsx(A,{variant:"body1",paragraph:!0,children:"Your campaign doesn't have any locations yet. Import data or create locations in edit mode."}),a.jsx(le,{variant:"contained",color:"primary",sx:{mr:1},onClick:()=>Y(!0),children:"Import Assets"}),a.jsx(le,{variant:"outlined",color:"secondary",onClick:on,children:x?"Exit Edit Mode":"Enter Edit Mode"})]})})]}),a.jsxs(ke,{open:O,onClose:()=>B(!1),maxWidth:"md",fullWidth:!0,children:[a.jsxs(xi,{children:["Edit Location",a.jsx(U,{"aria-label":"close",onClick:()=>B(!1),sx:{position:"absolute",right:8,top:8},children:a.jsx(xn,{})})]}),a.jsx(Ci,{dividers:!0,children:C&&a.jsxs(Cn,{spacing:2,children:[a.jsx(I,{label:"Name",fullWidth:!0,value:C.name,onChange:u=>N({...C,name:u.target.value})}),a.jsx(I,{label:"Description",fullWidth:!0,multiline:!0,rows:4,value:C.description,onChange:u=>N({...C,description:u.target.value})}),C&&C.coordinates&&a.jsxs(j,{sx:{display:"flex",gap:2},children:[a.jsx(I,{label:"X Coordinate",type:"number",InputProps:{inputProps:{min:0,max:1,step:.01}},value:C.coordinates[0],onChange:u=>{if(C.coordinates){const f=parseFloat(u.target.value),v=C.coordinates[1];N({...C,coordinates:[f,v]})}}}),a.jsx(I,{label:"Y Coordinate",type:"number",InputProps:{inputProps:{min:0,max:1,step:.01}},value:C.coordinates[1],onChange:u=>{if(C.coordinates){const f=C.coordinates[0],v=parseFloat(u.target.value);N({...C,coordinates:[f,v]})}}})]}),a.jsxs(Fe,{fullWidth:!0,children:[a.jsx(Ve,{children:"Background Map Image"}),a.jsxs($e,{value:C.imageUrl||"",label:"Background Map Image",onChange:u=>N({...C,imageUrl:u.target.value||void 0}),children:[a.jsx(he,{value:"",children:"None"}),pe.map(u=>a.jsx(he,{value:u,children:u},u))]})]}),a.jsxs(Fe,{fullWidth:!0,children:[a.jsx(Ve,{children:"Background Music"}),a.jsxs($e,{value:C.backgroundMusic||"",label:"Background Music",onChange:u=>N({...C,backgroundMusic:u.target.value||void 0}),children:[a.jsx(he,{value:"",children:"None"}),ae.map(u=>a.jsx(he,{value:u,children:u},u))]})]}),a.jsxs(Fe,{fullWidth:!0,children:[a.jsx(Ve,{children:"Entry Sound"}),a.jsxs($e,{value:C.entrySound||"",label:"Entry Sound",onChange:u=>N({...C,entrySound:u.target.value||void 0}),children:[a.jsx(he,{value:"",children:"None"}),ae.map(u=>a.jsx(he,{value:u,children:u},u))]})]}),a.jsx(wn,{control:a.jsx(jn,{checked:C.mixWithParent||!1,onChange:u=>N({...C,mixWithParent:u.target.checked})}),label:"Mix audio with parent location"})]})}),a.jsxs(Pn,{children:[C&&a.jsx(le,{color:"error",startIcon:a.jsx(wi,{}),onClick:()=>{if(window.confirm("Are you sure you want to delete this location? This cannot be undone.")){const u=z.getState().deleteLocation;u(C.id),z.getState().saveDataToIndexedDB(),B(!1),N(null)}},children:"Delete"}),a.jsx(le,{onClick:()=>B(!1),children:"Cancel"}),a.jsx(le,{onClick:()=>{if(C){const u=z.getState().updateLocation;u(C.id,C),z.getState().saveDataToIndexedDB(),B(!1),N(null)}},variant:"contained",children:"Save"})]})]}),a.jsxs(ke,{open:P,onClose:()=>Y(!1),maxWidth:"md",fullWidth:!0,children:[a.jsx(xi,{children:a.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:["Asset Manager",a.jsx(U,{edge:"end",onClick:()=>Y(!1),children:a.jsx(qe,{})})]})}),a.jsx(Ci,{dividers:!0,children:a.jsx(Yi,{onAssetImport:Ee})})]}),a.jsx(ke,{open:Ce,onClose:()=>we(!1),maxWidth:"sm",fullWidth:!0,children:un()}),a.jsx(ke,{open:ze,onClose:()=>te(!1),maxWidth:"sm",fullWidth:!0,children:pn()})]}):a.jsx(j,{sx:{height:"calc(100vh - 64px)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:4,backgroundColor:"background.default"},children:a.jsxs(yi,{elevation:3,sx:{maxWidth:600,width:"100%",p:4,display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:"rgba(45, 45, 45, 0.9)"},children:[a.jsx(A,{variant:"h4",gutterBottom:!0,align:"center",sx:{mb:2},children:"Welcome to Pen & Paper Project"}),a.jsx(A,{variant:"body1",paragraph:!0,align:"center",children:"No campaign assets found. Please upload a zip file containing your campaign assets to get started."}),a.jsx(A,{variant:"body2",paragraph:!0,align:"center",color:"text.secondary",sx:{mb:3},children:'Your zip file should contain an "audio" folder for sound files, an "images" folder for location images, and a "data" folder with your "locations.json" and "characters.json" files.'}),a.jsx(Yi,{onAssetImport:Ee,isFullPage:!0})]})})};export{ea as MapView};
