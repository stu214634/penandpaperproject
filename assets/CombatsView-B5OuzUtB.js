import{i as U,j as e,B as i,d as r,e as g,N as M,X as Z,Y as V,a2 as I,I as N,l as ee,m as se,n as te,o as u,ae as v,af as S,ag as k,ah as c,a6 as f,k as ae,L as ne,f as ie,h as re,ak as le,r as oe}from"./mui-vendor-BNyFSCPN.js";import{r as x}from"./react-vendor-BzdEknB4.js";import{r as de,u as ce,e as W,i as ue,b as $}from"./index-B572UWve.js";import{d as xe}from"./Edit-CQOYtz5d.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var A={},he=U;Object.defineProperty(A,"__esModule",{value:!0});var O=A.default=void 0,me=he(de()),pe=e;O=A.default=(0,me.default)((0,pe.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove");const be=()=>{const{combats:H,characters:C,locations:E,addCombat:L,updateCombat:R,deleteCombat:z}=ce(),[m,j]=x.useState(!1),[h,D]=x.useState(null),[w,q]=x.useState([]),[T,F]=x.useState([]),[d,p]=x.useState([]),[l,o]=x.useState({name:"",description:"",descriptionType:"markdown",playerCharacters:[],enemies:[],difficulty:"medium"}),b=C.filter(s=>s.type==="player"),P=C.filter(s=>s.type==="enemy");x.useEffect(()=>{m&&(async()=>{const t=await $.getAssets("audio");q(t.map(n=>n.name));const a=await $.getAssets("images");F(a.map(n=>n.name))})()},[m]),x.useEffect(()=>{if(m&&h){const s=new Map,t=new Map;h.enemies.forEach(n=>{const y=s.get(n.id)||0;s.set(n.id,y+1),t.set(n.id,n)});const a=[];s.forEach((n,y)=>{const B=t.get(y);B&&a.push({character:B,count:n})}),p(a)}else m&&!h&&p([])},[m,h]);const G=()=>{D(null),o({name:"",description:"",descriptionType:"markdown",playerCharacters:[],enemies:[],difficulty:"medium"}),p([]),j(!0)},Q=s=>{D(s),o({...s}),j(!0)},X=s=>{window.confirm("Are you sure you want to delete this combat?")&&z(s)},Y=()=>{if(!l.name){alert("Please fill in all required fields");return}let s=[];d.forEach(a=>{for(let n=0;n<a.count;n++)s.push(a.character)});const t={...l,enemies:s};h?R(h.id,t):L(t),j(!1)},J=(s,t)=>{{const a=C.filter(n=>s.includes(n.id));o(n=>({...n,playerCharacters:a}))}},_=s=>{const t=P.find(n=>n.id===s);if(!t)return;const a=d.findIndex(n=>n.character.id===s);if(a>=0){const n=[...d];n[a]={...n[a],count:n[a].count+1},p(n)}else p([...d,{character:t,count:1}])},K=s=>{const t=d.findIndex(a=>a.character.id===s);if(t>=0){const a=[...d];a[t].count>1?a[t]={...a[t],count:a[t].count-1}:a.splice(t,1),p(a)}};return e.jsxs(i,{sx:{p:3},children:[e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(r,{variant:"h4",children:"Combat Encounters"}),e.jsx(g,{variant:"contained",color:"primary",startIcon:e.jsx(W,{}),onClick:G,children:"Add Combat"})]}),e.jsx(M,{container:!0,spacing:3,children:H.map(s=>e.jsx(M,{item:!0,xs:12,md:6,children:e.jsx(Z,{children:e.jsx(V,{children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(i,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:s.name}),e.jsxs(r,{variant:"body2",color:"textSecondary",gutterBottom:!0,children:["Difficulty: ",s.difficulty||"Not set"]}),e.jsx(r,{variant:"body2",sx:{mb:2},children:s.description}),e.jsxs(i,{sx:{mt:2},children:[e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["Players (",s.playerCharacters.length,"):"]}),e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5,mb:1},children:[s.playerCharacters.map(t=>e.jsx(I,{label:`${t.name} (HP: ${t.hp})`,size:"small",color:"success",variant:"outlined"},t.id)),s.playerCharacters.length===0&&e.jsx(r,{variant:"body2",color:"text.secondary",children:"No players assigned"})]}),e.jsxs(r,{variant:"subtitle2",gutterBottom:!0,children:["Enemies (",s.enemies.length,"):"]}),e.jsxs(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:[Object.entries(s.enemies.reduce((t,a)=>(t[a.id]=(t[a.id]||0)+1,t),{})).map(([t,a])=>{const n=s.enemies.find(y=>y.id===t);return n?e.jsx(I,{label:`${n.name} ${a>1?`(${a}) `:""}(HP: ${n.hp})`,size:"small",color:"error",variant:"outlined"},t):null}),s.enemies.length===0&&e.jsx(r,{variant:"body2",color:"text.secondary",children:"No enemies assigned"})]})]})]}),e.jsxs(i,{children:[e.jsx(N,{onClick:()=>Q(s),children:e.jsx(xe,{})}),e.jsx(N,{onClick:()=>X(s.id),children:e.jsx(ue,{})})]})]})})})},s.id))}),e.jsxs(ee,{open:m,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(se,{children:h?"Edit Combat":"New Combat"}),e.jsx(te,{children:e.jsxs(i,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(u,{label:"Name",fullWidth:!0,value:l.name||"",onChange:s=>o(t=>({...t,name:s.target.value}))}),e.jsx(u,{label:"Description",fullWidth:!0,multiline:!0,rows:4,value:l.description||"",onChange:s=>o(t=>({...t,description:s.target.value}))}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(S,{children:"Description Type"}),e.jsxs(k,{value:l.descriptionType||"markdown",label:"Description Type",onChange:s=>o(t=>({...t,descriptionType:s.target.value})),children:[e.jsx(c,{value:"markdown",children:"Markdown"}),e.jsx(c,{value:"image",children:"Image"}),e.jsx(c,{value:"pdf",children:"PDF"})]})]}),l.descriptionType!=="markdown"&&e.jsx(f,{options:T,value:l.descriptionAssetName||null,onChange:(s,t)=>o(a=>({...a,descriptionAssetName:t||void 0})),renderInput:s=>e.jsx(u,{...s,label:"Description Asset",helperText:"Select an image or PDF file from assets"})}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(S,{children:"Player Characters"}),e.jsxs(k,{multiple:!0,value:(l.playerCharacters||[]).map(s=>s.id),label:"Player Characters",onChange:s=>J(s.target.value),renderValue:s=>e.jsx(i,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:s.map(t=>{const a=b.find(n=>n.id===t);return a?e.jsx(I,{label:a.name,size:"small",color:"success"},t):null})}),MenuProps:{PaperProps:{style:{maxHeight:224}}},children:[b.map(s=>e.jsx(c,{value:s.id,children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:s.name}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["HP: ",s.hp]})]})},s.id)),b.length===0&&e.jsx(c,{disabled:!0,children:"No player characters available. Add some first."})]}),e.jsx(r,{variant:"caption",sx:{mt:.5,ml:1.5},children:"Select multiple player characters (hold Ctrl/Cmd to select multiple)"})]}),e.jsxs(i,{sx:{border:1,borderColor:"divider",p:2,borderRadius:1},children:[e.jsx(r,{variant:"subtitle1",gutterBottom:!0,children:"Enemies"}),e.jsx(v,{fullWidth:!0,sx:{mb:2},children:e.jsx(f,{options:P,getOptionLabel:s=>s.name,renderOption:(s,t)=>e.jsx(i,{component:"li",...s,children:e.jsxs(i,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx("span",{children:t.name}),e.jsxs(r,{variant:"body2",color:"text.secondary",children:["HP: ",t.hp]})]})}),renderInput:s=>e.jsx(u,{...s,label:"Add Enemy"}),onChange:(s,t)=>{t&&_(t.id)},value:null,noOptionsText:"No enemy characters available. Add some first."})}),e.jsx(ae,{sx:{mb:2}}),e.jsx(r,{variant:"subtitle2",gutterBottom:!0,children:"Current Enemies:"}),d.length===0?e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"No enemies added to this combat. Select enemies above."}):e.jsx(ne,{children:d.map((s,t)=>e.jsxs(ie,{divider:t<d.length-1,children:[e.jsx(re,{primary:s.character.name,secondary:`HP: ${s.character.hp}`}),e.jsxs(i,{sx:{display:"flex",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",sx:{mr:2},children:["Quantity: ",s.count]}),e.jsxs(le,{size:"small",children:[e.jsx(g,{onClick:()=>_(s.character.id),color:"primary",children:e.jsx(W,{fontSize:"small"})}),e.jsx(g,{onClick:()=>K(s.character.id),color:"error",children:e.jsx(O,{fontSize:"small"})})]})]})]},t))})]}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(S,{children:"Difficulty"}),e.jsxs(k,{value:l.difficulty||"medium",label:"Difficulty",onChange:s=>o(t=>({...t,difficulty:s.target.value})),children:[e.jsx(c,{value:"easy",children:"Easy"}),e.jsx(c,{value:"medium",children:"Medium"}),e.jsx(c,{value:"hard",children:"Hard"}),e.jsx(c,{value:"custom",children:"Custom"})]})]}),e.jsx(f,{options:E,value:E.find(s=>s.id===l.locationId)||null,onChange:(s,t)=>o(a=>({...a,locationId:(t==null?void 0:t.id)||void 0})),getOptionLabel:s=>s.name,renderInput:s=>e.jsx(u,{...s,label:"Location",helperText:"Select a location for this combat"}),isOptionEqualToValue:(s,t)=>s.id===t.id}),e.jsx(f,{options:w,value:l.entrySound||null,onChange:(s,t)=>o(a=>({...a,entrySound:t||void 0})),renderInput:s=>e.jsx(u,{...s,label:"Entry Sound",helperText:"Select an audio file from assets"})}),e.jsx(f,{options:w,value:l.backgroundMusic||null,onChange:(s,t)=>o(a=>({...a,backgroundMusic:t||void 0})),renderInput:s=>e.jsx(u,{...s,label:"Background Music",helperText:"Select an audio file from assets"})}),e.jsx(f,{options:T,value:l.backgroundImage||null,onChange:(s,t)=>o(a=>({...a,backgroundImage:t||void 0})),renderInput:s=>e.jsx(u,{...s,label:"Background Image",helperText:"Select an image file from assets"})})]})}),e.jsxs(oe,{children:[e.jsx(g,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(g,{onClick:Y,variant:"contained",color:"primary",children:"Save"})]})]})]})};export{be as CombatsView};
//# sourceMappingURL=CombatsView-B5OuzUtB.js.map
