import{i as Z,j as e,B as l,d as c,e as h,P,l as D,m as _,n as E,N as a,o,a6 as p,ae as X,af as G,ag as V,ah as J,q as S,I as j,a2 as g,F as K,S as Q,r as A,ai as De,X as _e,Y as Ee,aj as Ae}from"./mui-vendor-BNyFSCPN.js";import{r as d}from"./react-vendor-BzdEknB4.js";import{r as ee,u as $e,f as Ue,e as $,g as I,M as W,a as ze,d as Fe,b as U,h as Oe,i as Be,j as Ne}from"./index-B572UWve.js";import{d as qe}from"./Edit-CQOYtz5d.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var z={},He=Z;Object.defineProperty(z,"__esModule",{value:!0});var te=z.default=void 0,Re=He(ee()),Ye=e;te=z.default=(0,Re.default)((0,Ye.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var F={},Xe=Z;Object.defineProperty(F,"__esModule",{value:!0});var ne=F.default=void 0,Ge=Xe(ee()),Ve=e;ne=F.default=(0,Ge.default)((0,Ve.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const nt=()=>{const[ie,b]=d.useState(!1),[ae,y]=d.useState(!1),[se,O]=d.useState(!1),[oe,re]=d.useState(""),[n,s]=d.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),[C,B]=d.useState(null),[L,le]=d.useState([]),[N,de]=d.useState([]),[q,H]=d.useState(!1),[ce,ue]=d.useState({}),[xe,k]=d.useState(!1),[pe,he]=d.useState(""),[me,je]=d.useState(""),{locations:x,addLocation:ge,updateLocation:fe,deleteLocation:be,getAllTopLevelLocations:ve,getSublocationsByParentId:ye,saveDataToIndexedDB:Ce}=$e(),Le=ve();d.useEffect(()=>{(async()=>{try{const i=await U.getAssets("audio");le(i.map(u=>u.name));const r=await U.getAssets("images");de(r.map(u=>u.name))}catch(i){console.error("Error loading assets:",i)}})()},[]);const ke=()=>{ge({name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),b(!1),w(),v("Location added successfully")},w=()=>{s({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]})},Se=t=>{ue(i=>({...i,[t]:!i[t]}))},Ie=t=>{const i=x.find(r=>r.id===t);i&&(B(t),s({name:i.name,description:i.description,backgroundMusic:i.backgroundMusic||"",entrySound:i.entrySound||"",imageUrl:i.imageUrl||"",descriptionType:i.descriptionType||"markdown",parentLocationId:i.parentLocationId||"",coordinates:i.coordinates||[0,0],mixWithParent:i.mixWithParent||!1,connectedLocations:i.connectedLocations||[]}),y(!0))},We=()=>{C&&(fe(C,{name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),y(!1),w(),B(null),v("Location updated successfully"))},we=t=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(be(t),v("Location deleted successfully"))},Me=async()=>{H(!0);try{const t=await Ce();v(t.message)}catch(t){v(`Error saving data: ${t instanceof Error?t.message:String(t)}`)}finally{H(!1)}},v=t=>{re(t),O(!0)},Te=()=>{O(!1)},R=(t,i=0)=>{const r=ce[t.id]||!1,u=ye(t.id),M=u.length>0;return e.jsxs(l,{sx:{mb:2},children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{children:[e.jsx(c,{variant:"h6",component:"div",children:t.name}),t.imageUrl&&e.jsxs(l,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[e.jsx(c,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),e.jsx(l,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:e.jsx("img",{src:`/images/${t.imageUrl}`,alt:`Map of ${t.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async f=>{try{if(t.imageUrl){const m=await U.getAssetUrl("images",t.imageUrl);m&&(f.target.src=m)}}catch(m){console.error("Error loading location image:",m)}}})})]}),e.jsxs(l,{onClick:()=>{he(t.description),je(t.name),k(!0)},sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},borderRadius:1,p:1,mt:1},children:[e.jsx(l,{sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx(W,{content:t.description,sx:{"& table":{display:"block",maxWidth:"100%",overflow:"auto",whiteSpace:"nowrap"},"& th, & td":{px:1,py:.5,fontSize:"0.8rem"}}})}),t.description.length>100&&e.jsx(c,{variant:"caption",color:"primary",sx:{display:"block",mt:.5},children:"Click to view full description"})]}),e.jsxs(l,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[t.backgroundMusic&&e.jsx(g,{icon:e.jsx(ne,{}),label:`Music: ${t.backgroundMusic}`,size:"small",variant:"outlined"}),t.entrySound&&e.jsx(g,{icon:e.jsx(Oe,{}),label:`Sound: ${t.entrySound}`,size:"small",variant:"outlined"}),t.coordinates&&e.jsx(g,{label:`Coords: ${t.coordinates[0]}, ${t.coordinates[1]}`,size:"small",variant:"outlined"}),t.mixWithParent&&e.jsx(g,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"}),t.connectedLocations&&t.connectedLocations.length>0&&e.jsx(g,{label:`${t.connectedLocations.length} Connected Locations`,size:"small",color:"success",variant:"outlined",onClick:f=>{f.stopPropagation();const m=t.connectedLocations.map(T=>{var Y;return((Y=x.find(Pe=>Pe.id===T))==null?void 0:Y.name)||"Unknown"}).join(", ");alert(`Connected to: ${m}`)}}),M&&e.jsx(g,{label:`${u.length} Sublocations`,size:"small",color:"success",variant:"outlined",onClick:f=>{f.stopPropagation();const m=u.map(T=>T.name).join(", ");alert(`Sublocations: ${m}`)}})]})]}),e.jsxs(l,{children:[e.jsx(j,{onClick:()=>Ie(t.id),children:e.jsx(qe,{})}),e.jsx(j,{onClick:()=>we(t.id),children:e.jsx(Be,{})}),M&&e.jsx(j,{onClick:()=>Se(t.id),children:r?e.jsx(te,{}):e.jsx(Ne,{})})]})]})}),e.jsx(Ae,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(h,{size:"small",startIcon:e.jsx($,{}),onClick:()=>{s({...n,parentLocationId:t.id}),b(!0)},children:"Add Sublocation"})})]}),M&&r&&e.jsx(l,{sx:{pl:4,mt:1},children:u.map(f=>R(f,i+1))})]},t.id)};return e.jsxs(l,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h4",children:"Locations"}),e.jsxs(l,{children:[e.jsx(h,{variant:"outlined",color:"success",startIcon:e.jsx(Ue,{}),onClick:Me,disabled:q,sx:{mr:2},children:q?"Saving...":"Save Changes"}),e.jsx(h,{variant:"contained",startIcon:e.jsx($,{}),onClick:()=>{w(),b(!0)},children:"Add Location"})]})]}),x.length===0?e.jsxs(P,{sx:{p:3,textAlign:"center"},children:[e.jsx(c,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),e.jsx(c,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),e.jsx(h,{variant:"contained",startIcon:e.jsx($,{}),onClick:()=>b(!0),children:"Add Location"})]}):e.jsx(l,{children:Le.map(t=>R(t))}),e.jsxs(D,{open:ie,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(_,{children:"Add New Location"}),e.jsx(E,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>s({...n,name:t.target.value})})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:x,value:x.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>s({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(G,{children:"Description Type"}),e.jsx(V,{value:n.descriptionType,label:"Description Type",onChange:t=>s({...n,descriptionType:t.target.value}),children:e.jsx(J,{value:"markdown",children:"Markdown"})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(c,{variant:"subtitle2",children:"Description"}),e.jsx(S,{title:e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"caption",sx:{display:"block",fontWeight:"bold"},children:"Markdown Table Example:"}),e.jsx(c,{variant:"caption",component:"pre",sx:{display:"block",mt:1,fontFamily:"monospace"},children:"| Header 1 | Header 2 | Header 3 |\\n | -------- | -------- | -------- |\\n | Cell 1   | Cell 2   | Cell 3   |\\n | Cell 4   | Cell 5   | Cell 6   |"})]}),children:e.jsx(j,{size:"small",sx:{ml:1},children:e.jsx(I,{fontSize:"small"})})})]}),e.jsx(o,{fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>s({...n,description:t.target.value})})]}),n.descriptionType==="markdown"&&e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(P,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(W,{content:n.description})})]}),e.jsx(a,{item:!0,xs:12,children:e.jsx(p,{multiple:!0,options:x.filter(t=>t.id!==n.parentLocationId),value:x.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>s({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,u)=>d.createElement(g,{label:r.name,...i({index:u}),key:r.id}))})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:L,value:n.backgroundMusic,onChange:(t,i)=>s({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:L,value:n.entrySound,onChange:(t,i)=>s({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:N,value:n.imageUrl,onChange:(t,i)=>s({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>s({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>s({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(K,{control:e.jsx(Q,{checked:n.mixWithParent,onChange:t=>s({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(S,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(j,{size:"small",children:e.jsx(I,{fontSize:"small"})})})]})]})}),e.jsxs(A,{children:[e.jsx(h,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(h,{onClick:ke,variant:"contained",disabled:!n.name,children:"Add Location"})]})]}),e.jsxs(D,{open:ae,onClose:()=>y(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(_,{children:"Edit Location"}),e.jsx(E,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>s({...n,name:t.target.value})})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:x.filter(t=>t.id!==C),value:x.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>s({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(X,{fullWidth:!0,children:[e.jsx(G,{children:"Description Type"}),e.jsx(V,{value:n.descriptionType,label:"Description Type",onChange:t=>s({...n,descriptionType:t.target.value}),children:e.jsx(J,{value:"markdown",children:"Markdown"})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(c,{variant:"subtitle2",children:"Description"}),e.jsx(S,{title:e.jsxs(e.Fragment,{children:[e.jsx(c,{variant:"caption",sx:{display:"block",fontWeight:"bold"},children:"Markdown Table Example:"}),e.jsx(c,{variant:"caption",component:"pre",sx:{display:"block",mt:1,fontFamily:"monospace"},children:"| Header 1 | Header 2 | Header 3 |\\n | -------- | -------- | -------- |\\n | Cell 1   | Cell 2   | Cell 3   |\\n | Cell 4   | Cell 5   | Cell 6   |"})]}),children:e.jsx(j,{size:"small",sx:{ml:1},children:e.jsx(I,{fontSize:"small"})})})]}),e.jsx(o,{fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>s({...n,description:t.target.value})})]}),n.descriptionType==="markdown"&&e.jsxs(a,{item:!0,xs:12,children:[e.jsx(c,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(P,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(W,{content:n.description})})]}),e.jsx(a,{item:!0,xs:12,children:e.jsx(p,{multiple:!0,options:x.filter(t=>t.id!==C&&t.id!==n.parentLocationId),value:x.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>s({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,u)=>d.createElement(g,{label:r.name,...i({index:u}),key:r.id}))})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:L,value:n.backgroundMusic,onChange:(t,i)=>s({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:L,value:n.entrySound,onChange:(t,i)=>s({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(p,{options:N,value:n.imageUrl,onChange:(t,i)=>s({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>s({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>s({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(K,{control:e.jsx(Q,{checked:n.mixWithParent,onChange:t=>s({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(S,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(j,{size:"small",children:e.jsx(I,{fontSize:"small"})})})]})]})}),e.jsxs(A,{children:[e.jsx(h,{onClick:()=>y(!1),children:"Cancel"}),e.jsx(h,{onClick:We,variant:"contained",disabled:!n.name,children:"Save Changes"})]})]}),e.jsx(De,{open:se,autoHideDuration:6e3,onClose:Te,message:oe}),e.jsx(ze,{}),e.jsxs(D,{open:xe,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(_,{children:[me," - Description",e.jsx(j,{"aria-label":"close",onClick:()=>k(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(Fe,{})})]}),e.jsx(E,{dividers:!0,children:e.jsx(W,{content:pe})}),e.jsx(A,{children:e.jsx(h,{onClick:()=>k(!1),children:"Close"})})]})]})};export{nt as LocationsView};
//# sourceMappingURL=LocationsView-CcTic_El.js.map
