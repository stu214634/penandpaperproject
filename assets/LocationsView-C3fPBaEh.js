import{i as Z,j as e,B as d,d as m,e as p,P as M,l as T,m as P,n as D,N as a,o,a6 as x,ae as Y,af as X,ag as H,ah as G,a2 as j,F as V,S as J,q as K,I as v,r as _,ai as De,X as _e,Y as Ee,aj as Ae}from"./mui-vendor-BNyFSCPN.js";import{r as l}from"./react-vendor-BzdEknB4.js";import{r as ee,u as $e,f as Ue,e as E,M as S,g as Q,a as Oe,d as Fe,b as A,h as ze,i as Be,j as Ne}from"./index-CiYy6z63.js";import{d as qe}from"./Edit-Cqjbi-WV.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var $={},Re=Z;Object.defineProperty($,"__esModule",{value:!0});var te=$.default=void 0,Ye=Re(ee()),Xe=e;te=$.default=(0,Ye.default)((0,Xe.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var U={},He=Z;Object.defineProperty(U,"__esModule",{value:!0});var ne=U.default=void 0,Ge=He(ee()),Ve=e;ne=U.default=(0,Ge.default)((0,Ve.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const nt=()=>{const[ie,f]=l.useState(!1),[ae,L]=l.useState(!1),[se,O]=l.useState(!1),[oe,re]=l.useState(""),[n,s]=l.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),[y,F]=l.useState(null),[C,le]=l.useState([]),[z,de]=l.useState([]),[B,N]=l.useState(!1),[ce,ue]=l.useState({}),[xe,k]=l.useState(!1),[pe,he]=l.useState(""),[me,je]=l.useState(""),{locations:u,addLocation:ge,updateLocation:fe,deleteLocation:ve,getAllTopLevelLocations:be,getSublocationsByParentId:Le,saveDataToIndexedDB:ye}=$e(),Ce=be();l.useEffect(()=>{(async()=>{try{const i=await A.getAssets("audio");le(i.map(c=>c.name));const r=await A.getAssets("images");de(r.map(c=>c.name))}catch(i){console.error("Error loading assets:",i)}})()},[]);const ke=()=>{ge({name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),f(!1),I(),b("Location added successfully")},I=()=>{s({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]})},Se=t=>{ue(i=>({...i,[t]:!i[t]}))},Ie=t=>{const i=u.find(r=>r.id===t);i&&(F(t),s({name:i.name,description:i.description,backgroundMusic:i.backgroundMusic||"",entrySound:i.entrySound||"",imageUrl:i.imageUrl||"",descriptionType:i.descriptionType||"markdown",parentLocationId:i.parentLocationId||"",coordinates:i.coordinates||[0,0],mixWithParent:i.mixWithParent||!1,connectedLocations:i.connectedLocations||[]}),L(!0))},We=()=>{y&&(fe(y,{name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),L(!1),I(),F(null),b("Location updated successfully"))},we=t=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(ve(t),b("Location deleted successfully"))},Me=async()=>{N(!0);try{const t=await ye();b(t.message)}catch(t){b(`Error saving data: ${t instanceof Error?t.message:String(t)}`)}finally{N(!1)}},b=t=>{re(t),O(!0)},Te=()=>{O(!1)},q=(t,i=0)=>{const r=ce[t.id]||!1,c=Le(t.id),W=c.length>0;return e.jsxs(d,{sx:{mb:2},children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(d,{children:[e.jsx(m,{variant:"h6",component:"div",children:t.name}),t.imageUrl&&e.jsxs(d,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[e.jsx(m,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),e.jsx(d,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:e.jsx("img",{src:`/images/${t.imageUrl}`,alt:`Map of ${t.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async g=>{try{if(t.imageUrl){const h=await A.getAssetUrl("images",t.imageUrl);h&&(g.target.src=h)}}catch(h){console.error("Error loading location image:",h)}}})})]}),e.jsxs(d,{onClick:()=>{he(t.description),je(t.name),k(!0)},sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},borderRadius:1,p:1,mt:1},children:[e.jsx(d,{sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx(S,{content:t.description})}),t.description.length>100&&e.jsx(m,{variant:"caption",color:"primary",sx:{display:"block",mt:.5},children:"Click to view full description"})]}),e.jsxs(d,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[t.backgroundMusic&&e.jsx(j,{icon:e.jsx(ne,{}),label:`Music: ${t.backgroundMusic}`,size:"small",variant:"outlined"}),t.entrySound&&e.jsx(j,{icon:e.jsx(ze,{}),label:`Sound: ${t.entrySound}`,size:"small",variant:"outlined"}),t.coordinates&&e.jsx(j,{label:`Coords: ${t.coordinates[0]}, ${t.coordinates[1]}`,size:"small",variant:"outlined"}),t.mixWithParent&&e.jsx(j,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"}),t.connectedLocations&&t.connectedLocations.length>0&&e.jsx(j,{label:`${t.connectedLocations.length} Connected Locations`,size:"small",color:"success",variant:"outlined",onClick:g=>{g.stopPropagation();const h=t.connectedLocations.map(w=>{var R;return((R=u.find(Pe=>Pe.id===w))==null?void 0:R.name)||"Unknown"}).join(", ");alert(`Connected to: ${h}`)}}),W&&e.jsx(j,{label:`${c.length} Sublocations`,size:"small",color:"success",variant:"outlined",onClick:g=>{g.stopPropagation();const h=c.map(w=>w.name).join(", ");alert(`Sublocations: ${h}`)}})]})]}),e.jsxs(d,{children:[e.jsx(v,{onClick:()=>Ie(t.id),children:e.jsx(qe,{})}),e.jsx(v,{onClick:()=>we(t.id),children:e.jsx(Be,{})}),W&&e.jsx(v,{onClick:()=>Se(t.id),children:r?e.jsx(te,{}):e.jsx(Ne,{})})]})]})}),e.jsx(Ae,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(p,{size:"small",startIcon:e.jsx(E,{}),onClick:()=>{s({...n,parentLocationId:t.id}),f(!0)},children:"Add Sublocation"})})]}),W&&r&&e.jsx(d,{sx:{pl:4,mt:1},children:c.map(g=>q(g,i+1))})]},t.id)};return e.jsxs(d,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(d,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(m,{variant:"h4",children:"Locations"}),e.jsxs(d,{children:[e.jsx(p,{variant:"outlined",color:"success",startIcon:e.jsx(Ue,{}),onClick:Me,disabled:B,sx:{mr:2},children:B?"Saving...":"Save Changes"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(E,{}),onClick:()=>{I(),f(!0)},children:"Add Location"})]})]}),u.length===0?e.jsxs(M,{sx:{p:3,textAlign:"center"},children:[e.jsx(m,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),e.jsx(m,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),e.jsx(p,{variant:"contained",startIcon:e.jsx(E,{}),onClick:()=>f(!0),children:"Add Location"})]}):e.jsx(d,{children:Ce.map(t=>q(t))}),e.jsxs(T,{open:ie,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"Add New Location"}),e.jsx(D,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>s({...n,name:t.target.value})})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:u,value:u.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>s({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(X,{children:"Description Type"}),e.jsx(H,{value:n.descriptionType,label:"Description Type",onChange:t=>s({...n,descriptionType:t.target.value}),children:e.jsx(G,{value:"markdown",children:"Markdown"})})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>s({...n,description:t.target.value})})}),n.descriptionType==="markdown"&&e.jsxs(a,{item:!0,xs:12,children:[e.jsx(m,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(M,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(S,{content:n.description})})]}),e.jsx(a,{item:!0,xs:12,children:e.jsx(x,{multiple:!0,options:u.filter(t=>t.id!==n.parentLocationId),value:u.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>s({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,c)=>l.createElement(j,{label:r.name,...i({index:c}),key:r.id}))})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.backgroundMusic,onChange:(t,i)=>s({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.entrySound,onChange:(t,i)=>s({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:z,value:n.imageUrl,onChange:(t,i)=>s({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>s({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>s({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(J,{checked:n.mixWithParent,onChange:t=>s({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(K,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(v,{size:"small",children:e.jsx(Q,{fontSize:"small"})})})]})]})}),e.jsxs(_,{children:[e.jsx(p,{onClick:()=>f(!1),children:"Cancel"}),e.jsx(p,{onClick:ke,variant:"contained",disabled:!n.name,children:"Add Location"})]})]}),e.jsxs(T,{open:ae,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"Edit Location"}),e.jsx(D,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>s({...n,name:t.target.value})})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:u.filter(t=>t.id!==y),value:u.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>s({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(Y,{fullWidth:!0,children:[e.jsx(X,{children:"Description Type"}),e.jsx(H,{value:n.descriptionType,label:"Description Type",onChange:t=>s({...n,descriptionType:t.target.value}),children:e.jsx(G,{value:"markdown",children:"Markdown"})})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>s({...n,description:t.target.value})})}),n.descriptionType==="markdown"&&e.jsxs(a,{item:!0,xs:12,children:[e.jsx(m,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(M,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(S,{content:n.description})})]}),e.jsx(a,{item:!0,xs:12,children:e.jsx(x,{multiple:!0,options:u.filter(t=>t.id!==y&&t.id!==n.parentLocationId),value:u.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>s({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,c)=>l.createElement(j,{label:r.name,...i({index:c}),key:r.id}))})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.backgroundMusic,onChange:(t,i)=>s({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.entrySound,onChange:(t,i)=>s({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsx(x,{options:z,value:n.imageUrl,onChange:(t,i)=>s({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(a,{item:!0,xs:12,md:6,children:e.jsxs(a,{container:!0,spacing:1,children:[e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>s({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(a,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>s({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(J,{checked:n.mixWithParent,onChange:t=>s({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(K,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(v,{size:"small",children:e.jsx(Q,{fontSize:"small"})})})]})]})}),e.jsxs(_,{children:[e.jsx(p,{onClick:()=>L(!1),children:"Cancel"}),e.jsx(p,{onClick:We,variant:"contained",disabled:!n.name,children:"Save Changes"})]})]}),e.jsx(De,{open:se,autoHideDuration:6e3,onClose:Te,message:oe}),e.jsx(Oe,{}),e.jsxs(T,{open:xe,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(P,{children:[me," - Description",e.jsx(v,{"aria-label":"close",onClick:()=>k(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(Fe,{})})]}),e.jsx(D,{dividers:!0,children:e.jsx(S,{content:pe})}),e.jsx(_,{children:e.jsx(p,{onClick:()=>k(!1),children:"Close"})})]})]})};export{nt as LocationsView};
//# sourceMappingURL=LocationsView-C3fPBaEh.js.map
