import{i as J,j as e,B as l,d as c,e as d,P as we,l as A,m as P,n as D,N as s,o as u,a6 as x,a7 as h,a8 as m,a9 as r,af as q,p as k,F as V,S as X,q as H,I as v,r as E,ag as Me,X as Ae,Y as Pe,a2 as I,ah as De}from"./mui-vendor-uU3VvFzt.js";import{r as o}from"./react-vendor-BzdEknB4.js";import{r as K,u as Ee,e as _e,c as _,f as G,g as Ne,d as $e,a as N,h as Ue,i as Be,j as Fe}from"./index-B-leRY4h.js";import{d as ze}from"./Edit-CcdAqHKO.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var $={},Te=J;Object.defineProperty($,"__esModule",{value:!0});var Q=$.default=void 0,Oe=Te(K()),Re=e;Q=$.default=(0,Oe.default)((0,Re.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var U={},Ye=J;Object.defineProperty(U,"__esModule",{value:!0});var Z=U.default=void 0,qe=Ye(K()),Ve=e;Z=U.default=(0,qe.default)((0,Ve.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const Ze=()=>{const[ee,j]=o.useState(!1),[te,b]=o.useState(!1),[ae,B]=o.useState(!1),[ne,se]=o.useState(""),[a,n]=o.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1}),[W,F]=o.useState(null),[y,ie]=o.useState([]),[z,re]=o.useState([]),[T,O]=o.useState(!1),[oe,le]=o.useState({}),[de,C]=o.useState(!1),[ce,ue]=o.useState(""),[xe,he]=o.useState(""),{locations:S,addLocation:me,updateLocation:je,deleteLocation:pe,getAllTopLevelLocations:ge,getSublocationsByParentId:ve,saveDataToIndexedDB:fe}=Ee(),be=ge();o.useEffect(()=>{(async()=>{try{const i=await N.getAssets("audio");ie(i.map(g=>g.name));const p=await N.getAssets("images");re(p.map(g=>g.name))}catch(i){console.error("Error loading assets:",i)}})()},[]);const ye=()=>{me({name:a.name,description:a.description,backgroundMusic:a.backgroundMusic||void 0,entrySound:a.entrySound||void 0,imageUrl:a.imageUrl||void 0,coordinates:a.coordinates.every(t=>t!==0)?a.coordinates:void 0,parentLocationId:a.parentLocationId||void 0,mixWithParent:a.mixWithParent}),j(!1),w(),f("Location added successfully")},w=()=>{n({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1})},Ce=t=>{le(i=>({...i,[t]:!i[t]}))},Se=t=>{const i=S.find(p=>p.id===t);i&&(F(t),n({name:i.name,description:i.description,backgroundMusic:i.backgroundMusic||"",entrySound:i.entrySound||"",imageUrl:i.imageUrl||"",parentLocationId:i.parentLocationId||"",coordinates:i.coordinates||[0,0],mixWithParent:i.mixWithParent||!1}),b(!0))},Le=()=>{W&&(je(W,{name:a.name,description:a.description,backgroundMusic:a.backgroundMusic||void 0,entrySound:a.entrySound||void 0,imageUrl:a.imageUrl||void 0,coordinates:a.coordinates.every(t=>t!==0)?a.coordinates:void 0,parentLocationId:a.parentLocationId||void 0,mixWithParent:a.mixWithParent}),b(!1),w(),F(null),f("Location updated successfully"))},ke=t=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(pe(t),f("Location deleted successfully"))},Ie=async()=>{O(!0);try{const t=await fe();f(t.message)}catch(t){f(`Error saving data: ${t instanceof Error?t.message:String(t)}`)}finally{O(!1)}},f=t=>{se(t),B(!0)},We=()=>{B(!1)},R=(t,i=0)=>{const p=oe[t.id]||!1,g=ve(t.id),Y=g.length>0;return e.jsxs(l,{sx:{mb:2},children:[e.jsxs(Ae,{children:[e.jsx(Pe,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{children:[e.jsx(c,{variant:"h6",component:"div",children:t.name}),t.imageUrl&&e.jsxs(l,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[e.jsx(c,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),e.jsx(l,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:e.jsx("img",{src:`/images/${t.imageUrl}`,alt:`Map of ${t.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async M=>{try{if(t.imageUrl){const L=await N.getAssetUrl("images",t.imageUrl);L&&(M.target.src=L)}}catch(L){console.error("Error loading location image:",L)}}})})]}),e.jsxs(l,{onClick:()=>{ue(t.description),he(t.name),C(!0)},sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},borderRadius:1,p:1,mt:1},children:[e.jsx(c,{variant:"body2",color:"text.secondary",sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:t.description}),t.description.length>100&&e.jsx(c,{variant:"caption",color:"primary",sx:{display:"block",mt:.5},children:"Click to view full description"})]}),e.jsxs(l,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[t.backgroundMusic&&e.jsx(I,{icon:e.jsx(Z,{}),label:`Music: ${t.backgroundMusic}`,size:"small",variant:"outlined"}),t.entrySound&&e.jsx(I,{icon:e.jsx(Ue,{}),label:`Sound: ${t.entrySound}`,size:"small",variant:"outlined"}),t.coordinates&&e.jsx(I,{label:`Coords: ${t.coordinates[0]}, ${t.coordinates[1]}`,size:"small",variant:"outlined"}),t.mixWithParent&&e.jsx(I,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"})]})]}),e.jsxs(l,{children:[e.jsx(v,{onClick:()=>Se(t.id),children:e.jsx(ze,{})}),e.jsx(v,{onClick:()=>ke(t.id),children:e.jsx(Be,{})}),Y&&e.jsx(v,{onClick:()=>Ce(t.id),children:p?e.jsx(Q,{}):e.jsx(Fe,{})})]})]})}),e.jsx(De,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(d,{size:"small",startIcon:e.jsx(_,{}),onClick:()=>{n({...a,parentLocationId:t.id}),j(!0)},children:"Add Sublocation"})})]}),Y&&p&&e.jsx(l,{sx:{pl:4,mt:1},children:g.map(M=>R(M,i+1))})]},t.id)};return e.jsxs(l,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(c,{variant:"h4",children:"Locations"}),e.jsxs(l,{children:[e.jsx(d,{variant:"outlined",color:"success",startIcon:e.jsx(_e,{}),onClick:Ie,disabled:T,sx:{mr:2},children:T?"Saving...":"Save Changes"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(_,{}),onClick:()=>{w(),j(!0)},children:"Add Location"})]})]}),S.length===0?e.jsxs(we,{sx:{p:3,textAlign:"center"},children:[e.jsx(c,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),e.jsx(c,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),e.jsx(d,{variant:"contained",startIcon:e.jsx(_,{}),onClick:()=>j(!0),children:"Add Location"})]}):e.jsx(l,{children:be.map(t=>R(t))}),e.jsxs(A,{open:ee,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"Add New Location"}),e.jsx(D,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Name",fullWidth:!0,value:a.name,onChange:t=>n({...a,name:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Parent Location"}),e.jsxs(m,{value:a.parentLocationId,label:"Parent Location",onChange:t=>n({...a,parentLocationId:t.target.value}),children:[e.jsx(r,{value:"",children:e.jsx("em",{children:"None (Top-level)"})}),S.map(t=>e.jsx(r,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:a.description,onChange:t=>n({...a,description:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Background Music"}),e.jsxs(m,{value:a.backgroundMusic,label:"Background Music",onChange:t=>n({...a,backgroundMusic:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Entry Sound"}),e.jsxs(m,{value:a.entrySound,label:"Entry Sound",onChange:t=>n({...a,entrySound:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Background Map Image"}),e.jsxs(m,{value:a.imageUrl,label:"Background Map Image",onChange:t=>n({...a,imageUrl:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),z.map(t=>e.jsx(r,{value:t,children:t},t))]}),e.jsx(q,{children:"Image to use as the background map for this location"})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"X Coordinate",type:"number",fullWidth:!0,value:a.coordinates[0],onChange:t=>n({...a,coordinates:[parseFloat(t.target.value)||0,a.coordinates[1]]}),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"X:"})}})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Y Coordinate",type:"number",fullWidth:!0,value:a.coordinates[1],onChange:t=>n({...a,coordinates:[a.coordinates[0],parseFloat(t.target.value)||0]}),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"Y:"})}})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(X,{checked:a.mixWithParent,onChange:t=>n({...a,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(H,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(v,{size:"small",children:e.jsx(G,{fontSize:"small"})})})]})]})}),e.jsxs(E,{children:[e.jsx(d,{onClick:()=>j(!1),children:"Cancel"}),e.jsx(d,{onClick:ye,variant:"contained",disabled:!a.name,children:"Add Location"})]})]}),e.jsxs(A,{open:te,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(P,{children:"Edit Location"}),e.jsx(D,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Name",fullWidth:!0,value:a.name,onChange:t=>n({...a,name:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Parent Location"}),e.jsxs(m,{value:a.parentLocationId,label:"Parent Location",onChange:t=>n({...a,parentLocationId:t.target.value}),children:[e.jsx(r,{value:"",children:e.jsx("em",{children:"None (Top-level)"})}),S.filter(t=>t.id!==W).map(t=>e.jsx(r,{value:t.id,children:t.name},t.id))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(u,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:a.description,onChange:t=>n({...a,description:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Background Music"}),e.jsxs(m,{value:a.backgroundMusic,label:"Background Music",onChange:t=>n({...a,backgroundMusic:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Entry Sound"}),e.jsxs(m,{value:a.entrySound,label:"Entry Sound",onChange:t=>n({...a,entrySound:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(t=>e.jsx(r,{value:t,children:t},t))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(x,{fullWidth:!0,children:[e.jsx(h,{children:"Background Map Image"}),e.jsxs(m,{value:a.imageUrl,label:"Background Map Image",onChange:t=>n({...a,imageUrl:t.target.value}),children:[e.jsx(r,{value:"",children:"None"}),z.map(t=>e.jsx(r,{value:t,children:t},t))]}),e.jsx(q,{children:"Image to use as the background map for this location"})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"X Coordinate",type:"number",fullWidth:!0,value:a.coordinates[0],onChange:t=>n({...a,coordinates:[parseFloat(t.target.value)||0,a.coordinates[1]]}),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"X:"})}})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(u,{label:"Y Coordinate",type:"number",fullWidth:!0,value:a.coordinates[1],onChange:t=>n({...a,coordinates:[a.coordinates[0],parseFloat(t.target.value)||0]}),InputProps:{startAdornment:e.jsx(k,{position:"start",children:"Y:"})}})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(V,{control:e.jsx(X,{checked:a.mixWithParent,onChange:t=>n({...a,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(H,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(v,{size:"small",children:e.jsx(G,{fontSize:"small"})})})]})]})}),e.jsxs(E,{children:[e.jsx(d,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{onClick:Le,variant:"contained",disabled:!a.name,children:"Save Changes"})]})]}),e.jsx(Me,{open:ae,autoHideDuration:6e3,onClose:We,message:ne}),e.jsx(Ne,{}),e.jsxs(A,{open:de,onClose:()=>C(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(P,{children:[xe," - Description",e.jsx(v,{"aria-label":"close",onClick:()=>C(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx($e,{})})]}),e.jsx(D,{dividers:!0,children:e.jsx(c,{variant:"body1",sx:{whiteSpace:"pre-wrap"},children:ce})}),e.jsx(E,{children:e.jsx(d,{onClick:()=>C(!1),children:"Close"})})]})]})};export{Ze as LocationsView};
