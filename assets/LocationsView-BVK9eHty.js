import{i as Q,j as e,B as l,d as h,e as p,P as W,l as w,m as M,n as T,N as s,o,a6 as x,ad as R,ae as Y,af as X,ag as H,a2 as m,F as G,S as V,q as J,I as f,r as P,ah as De,X as _e,Y as Ee,ai as Ae}from"./mui-vendor-B6rETHjT.js";import{r as d}from"./react-vendor-BzdEknB4.js";import{r as Z,u as $e,f as Ue,e as D,M as S,g as K,a as Oe,d as Fe,b as _,h as Be,i as ze,j as Ne}from"./index-j4jQxGJR.js";import{d as qe}from"./Edit-Dc_QG9DX.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var E={},Re=Q;Object.defineProperty(E,"__esModule",{value:!0});var ee=E.default=void 0,Ye=Re(Z()),Xe=e;ee=E.default=(0,Ye.default)((0,Xe.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var A={},He=Q;Object.defineProperty(A,"__esModule",{value:!0});var te=A.default=void 0,Ge=He(Z()),Ve=e;te=A.default=(0,Ge.default)((0,Ve.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const nt=()=>{const[ne,g]=d.useState(!1),[ie,L]=d.useState(!1),[se,$]=d.useState(!1),[ae,oe]=d.useState(""),[n,a]=d.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]}),[y,U]=d.useState(null),[C,re]=d.useState([]),[O,de]=d.useState([]),[F,B]=d.useState(!1),[le,ce]=d.useState({}),[ue,k]=d.useState(!1),[xe,pe]=d.useState(""),[he,me]=d.useState(""),{locations:c,addLocation:ge,updateLocation:je,deleteLocation:fe,getAllTopLevelLocations:ve,getSublocationsByParentId:be,saveDataToIndexedDB:Le}=$e(),ye=ve();d.useEffect(()=>{(async()=>{try{const i=await _.getAssets("audio");re(i.map(u=>u.name));const r=await _.getAssets("images");de(r.map(u=>u.name))}catch(i){console.error("Error loading assets:",i)}})()},[]);const Ce=()=>{ge({name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),g(!1),I(),v("Location added successfully")},I=()=>{a({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",descriptionType:"markdown",parentLocationId:"",coordinates:[0,0],mixWithParent:!1,connectedLocations:[]})},ke=t=>{ce(i=>({...i,[t]:!i[t]}))},Se=t=>{const i=c.find(r=>r.id===t);i&&(U(t),a({name:i.name,description:i.description,backgroundMusic:i.backgroundMusic||"",entrySound:i.entrySound||"",imageUrl:i.imageUrl||"",descriptionType:i.descriptionType||"markdown",parentLocationId:i.parentLocationId||"",coordinates:i.coordinates||[0,0],mixWithParent:i.mixWithParent||!1,connectedLocations:i.connectedLocations||[]}),L(!0))},Ie=()=>{y&&(je(y,{name:n.name,description:n.description,backgroundMusic:n.backgroundMusic||void 0,entrySound:n.entrySound||void 0,imageUrl:n.imageUrl||void 0,descriptionType:n.descriptionType,coordinates:n.coordinates.every(t=>t!==0)?n.coordinates:void 0,parentLocationId:n.parentLocationId||void 0,mixWithParent:n.mixWithParent,connectedLocations:n.connectedLocations.length>0?n.connectedLocations:void 0}),L(!1),I(),U(null),v("Location updated successfully"))},We=t=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(fe(t),v("Location deleted successfully"))},we=async()=>{B(!0);try{const t=await Le();v(t.message)}catch(t){v(`Error saving data: ${t instanceof Error?t.message:String(t)}`)}finally{B(!1)}},v=t=>{oe(t),$(!0)},Me=()=>{$(!1)},z=(t,i=0)=>{const r=le[t.id]||!1,u=be(t.id),N=u.length>0;return e.jsxs(l,{sx:{mb:2},children:[e.jsxs(_e,{children:[e.jsx(Ee,{children:e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(l,{children:[e.jsx(h,{variant:"h6",component:"div",children:t.name}),t.imageUrl&&e.jsxs(l,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[e.jsx(h,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),e.jsx(l,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:e.jsx("img",{src:`/images/${t.imageUrl}`,alt:`Map of ${t.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async b=>{try{if(t.imageUrl){const j=await _.getAssetUrl("images",t.imageUrl);j&&(b.target.src=j)}}catch(j){console.error("Error loading location image:",j)}}})})]}),e.jsxs(l,{onClick:()=>{pe(t.description),me(t.name),k(!0)},sx:{cursor:"pointer","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"},borderRadius:1,p:1,mt:1},children:[e.jsx(l,{sx:{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},children:e.jsx(S,{content:t.description})}),t.description.length>100&&e.jsx(h,{variant:"caption",color:"primary",sx:{display:"block",mt:.5},children:"Click to view full description"})]}),e.jsxs(l,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[t.backgroundMusic&&e.jsx(m,{icon:e.jsx(te,{}),label:`Music: ${t.backgroundMusic}`,size:"small",variant:"outlined"}),t.entrySound&&e.jsx(m,{icon:e.jsx(Be,{}),label:`Sound: ${t.entrySound}`,size:"small",variant:"outlined"}),t.coordinates&&e.jsx(m,{label:`Coords: ${t.coordinates[0]}, ${t.coordinates[1]}`,size:"small",variant:"outlined"}),t.mixWithParent&&e.jsx(m,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"}),t.connectedLocations&&t.connectedLocations.length>0&&e.jsx(m,{label:`${t.connectedLocations.length} Connected Locations`,size:"small",color:"success",variant:"outlined",onClick:b=>{b.stopPropagation();const j=t.connectedLocations.map(Te=>{var q;return((q=c.find(Pe=>Pe.id===Te))==null?void 0:q.name)||"Unknown"}).join(", ");alert(`Connected to: ${j}`)}})]})]}),e.jsxs(l,{children:[e.jsx(f,{onClick:()=>Se(t.id),children:e.jsx(qe,{})}),e.jsx(f,{onClick:()=>We(t.id),children:e.jsx(ze,{})}),N&&e.jsx(f,{onClick:()=>ke(t.id),children:r?e.jsx(ee,{}):e.jsx(Ne,{})})]})]})}),e.jsx(Ae,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(p,{size:"small",startIcon:e.jsx(D,{}),onClick:()=>{a({...n,parentLocationId:t.id}),g(!0)},children:"Add Sublocation"})})]}),N&&r&&e.jsx(l,{sx:{pl:4,mt:1},children:u.map(b=>z(b,i+1))})]},t.id)};return e.jsxs(l,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(h,{variant:"h4",children:"Locations"}),e.jsxs(l,{children:[e.jsx(p,{variant:"outlined",color:"success",startIcon:e.jsx(Ue,{}),onClick:we,disabled:F,sx:{mr:2},children:F?"Saving...":"Save Changes"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(D,{}),onClick:()=>{I(),g(!0)},children:"Add Location"})]})]}),c.length===0?e.jsxs(W,{sx:{p:3,textAlign:"center"},children:[e.jsx(h,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),e.jsx(h,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),e.jsx(p,{variant:"contained",startIcon:e.jsx(D,{}),onClick:()=>g(!0),children:"Add Location"})]}):e.jsx(l,{children:ye.map(t=>z(t))}),e.jsxs(w,{open:ne,onClose:()=>g(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(M,{children:"Add New Location"}),e.jsx(T,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>a({...n,name:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:c,value:c.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>a({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(R,{fullWidth:!0,children:[e.jsx(Y,{children:"Description Type"}),e.jsx(X,{value:n.descriptionType,label:"Description Type",onChange:t=>a({...n,descriptionType:t.target.value}),children:e.jsx(H,{value:"markdown",children:"Markdown"})})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>a({...n,description:t.target.value})})}),n.descriptionType==="markdown"&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(h,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(W,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(S,{content:n.description})})]}),e.jsx(s,{item:!0,xs:12,children:e.jsx(x,{multiple:!0,options:c.filter(t=>t.id!==n.parentLocationId),value:c.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>a({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,u)=>d.createElement(m,{label:r.name,...i({index:u}),key:r.id}))})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.backgroundMusic,onChange:(t,i)=>a({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.entrySound,onChange:(t,i)=>a({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:O,value:n.imageUrl,onChange:(t,i)=>a({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(s,{container:!0,spacing:1,children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>a({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>a({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(G,{control:e.jsx(V,{checked:n.mixWithParent,onChange:t=>a({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(J,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(f,{size:"small",children:e.jsx(K,{fontSize:"small"})})})]})]})}),e.jsxs(P,{children:[e.jsx(p,{onClick:()=>g(!1),children:"Cancel"}),e.jsx(p,{onClick:Ce,variant:"contained",disabled:!n.name,children:"Add Location"})]})]}),e.jsxs(w,{open:ie,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(M,{children:"Edit Location"}),e.jsx(T,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(o,{label:"Name",fullWidth:!0,value:n.name,onChange:t=>a({...n,name:t.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:c.filter(t=>t.id!==y),value:c.find(t=>t.id===n.parentLocationId)||null,onChange:(t,i)=>a({...n,parentLocationId:(i==null?void 0:i.id)||""}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Parent Location",fullWidth:!0}),isOptionEqualToValue:(t,i)=>t.id===i.id})}),e.jsx(s,{item:!0,xs:12,children:e.jsxs(R,{fullWidth:!0,children:[e.jsx(Y,{children:"Description Type"}),e.jsx(X,{value:n.descriptionType,label:"Description Type",onChange:t=>a({...n,descriptionType:t.target.value}),children:e.jsx(H,{value:"markdown",children:"Markdown"})})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(o,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:n.description,onChange:t=>a({...n,description:t.target.value})})}),n.descriptionType==="markdown"&&e.jsxs(s,{item:!0,xs:12,children:[e.jsx(h,{variant:"subtitle2",sx:{mt:1,mb:1},children:"Preview"}),e.jsx(W,{sx:{p:2,height:"200px",overflow:"auto",bgcolor:"background.default",border:1,borderColor:"divider"},children:e.jsx(S,{content:n.description})})]}),e.jsx(s,{item:!0,xs:12,children:e.jsx(x,{multiple:!0,options:c.filter(t=>t.id!==y&&t.id!==n.parentLocationId),value:c.filter(t=>n.connectedLocations.includes(t.id)),onChange:(t,i)=>a({...n,connectedLocations:i.map(r=>r.id)}),getOptionLabel:t=>t.name,renderInput:t=>e.jsx(o,{...t,label:"Connected Locations",fullWidth:!0,helperText:"Select locations that are connected to this one"}),isOptionEqualToValue:(t,i)=>t.id===i.id,renderTags:(t,i)=>t.map((r,u)=>d.createElement(m,{label:r.name,...i({index:u}),key:r.id}))})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.backgroundMusic,onChange:(t,i)=>a({...n,backgroundMusic:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Music",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:C,value:n.entrySound,onChange:(t,i)=>a({...n,entrySound:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Entry Sound",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(x,{options:O,value:n.imageUrl,onChange:(t,i)=>a({...n,imageUrl:i||""}),renderInput:t=>e.jsx(o,{...t,label:"Background Image",fullWidth:!0}),freeSolo:!0})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(s,{container:!0,spacing:1,children:[e.jsx(s,{item:!0,xs:6,children:e.jsx(o,{label:"X Coordinate",type:"number",fullWidth:!0,value:n.coordinates[0],onChange:t=>a({...n,coordinates:[parseFloat(t.target.value),n.coordinates[1]]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})}),e.jsx(s,{item:!0,xs:6,children:e.jsx(o,{label:"Y Coordinate",type:"number",fullWidth:!0,value:n.coordinates[1],onChange:t=>a({...n,coordinates:[n.coordinates[0],parseFloat(t.target.value)]}),InputProps:{inputProps:{min:0,max:1,step:.01}}})})]})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(G,{control:e.jsx(V,{checked:n.mixWithParent,onChange:t=>a({...n,mixWithParent:t.target.checked})}),label:"Mix audio with parent location"}),e.jsx(J,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(f,{size:"small",children:e.jsx(K,{fontSize:"small"})})})]})]})}),e.jsxs(P,{children:[e.jsx(p,{onClick:()=>L(!1),children:"Cancel"}),e.jsx(p,{onClick:Ie,variant:"contained",disabled:!n.name,children:"Save Changes"})]})]}),e.jsx(De,{open:se,autoHideDuration:6e3,onClose:Me,message:ae}),e.jsx(Oe,{}),e.jsxs(w,{open:ue,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsxs(M,{children:[he," - Description",e.jsx(f,{"aria-label":"close",onClick:()=>k(!1),sx:{position:"absolute",right:8,top:8},children:e.jsx(Fe,{})})]}),e.jsx(T,{dividers:!0,children:e.jsx(S,{content:xe})}),e.jsx(P,{children:e.jsx(p,{onClick:()=>k(!1),children:"Close"})})]})]})};export{nt as LocationsView};
//# sourceMappingURL=LocationsView-BVK9eHty.js.map
