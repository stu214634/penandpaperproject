import{i as G,j as e,B as o,d as p,e as d,P as Ce,l as z,m as T,n as O,N as s,o as c,a6 as u,a7 as x,a8 as h,a9 as r,af as R,p as L,F as Y,S as q,q as X,I as f,r as H,ag as Se,X as Le,Y as ke,a2 as k,ah as Ie}from"./mui-vendor-uU3VvFzt.js";import{r as l}from"./react-vendor-BzdEknB4.js";import{r as J,u as We,e as Me,c as A,f as V,g as Ae,a as P,h as Pe,i as we,j as Ee}from"./index-CmSG-kMy.js";import{d as De}from"./Edit-xfauPHYI.js";import"./map-vendor-CMk8R3PE.js";import"./utilities-BTDtKTyc.js";var w={},_e=G;Object.defineProperty(w,"__esModule",{value:!0});var K=w.default=void 0,Ue=_e(J()),$e=e;K=w.default=(0,Ue.default)((0,$e.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess");var E={},Ne=G;Object.defineProperty(E,"__esModule",{value:!0});var Q=E.default=void 0,Be=Ne(J()),Fe=e;Q=E.default=(0,Be.default)((0,Fe.jsx)("path",{d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3z"}),"MusicNote");const Xe=()=>{const[Z,m]=l.useState(!1),[ee,b]=l.useState(!1),[ae,D]=l.useState(!1),[te,ne]=l.useState(""),[t,n]=l.useState({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1}),[I,_]=l.useState(null),[y,se]=l.useState([]),[U,ie]=l.useState([]),[$,N]=l.useState(!1),[re,oe]=l.useState({}),{locations:C,addLocation:le,updateLocation:de,deleteLocation:ce,getAllTopLevelLocations:ue,getSublocationsByParentId:xe,saveDataToIndexedDB:he}=We(),me=ue();l.useEffect(()=>{(async()=>{try{const i=await P.getAssets("audio");se(i.map(g=>g.name));const j=await P.getAssets("images");ie(j.map(g=>g.name))}catch(i){console.error("Error loading assets:",i)}})()},[]);const je=()=>{le({name:t.name,description:t.description,backgroundMusic:t.backgroundMusic||void 0,entrySound:t.entrySound||void 0,imageUrl:t.imageUrl||void 0,coordinates:t.coordinates.every(a=>a!==0)?t.coordinates:void 0,parentLocationId:t.parentLocationId||void 0,mixWithParent:t.mixWithParent}),m(!1),W(),v("Location added successfully")},W=()=>{n({name:"",description:"",backgroundMusic:"",entrySound:"",imageUrl:"",parentLocationId:"",coordinates:[0,0],mixWithParent:!1})},ge=a=>{oe(i=>({...i,[a]:!i[a]}))},pe=a=>{const i=C.find(j=>j.id===a);i&&(_(a),n({name:i.name,description:i.description,backgroundMusic:i.backgroundMusic||"",entrySound:i.entrySound||"",imageUrl:i.imageUrl||"",parentLocationId:i.parentLocationId||"",coordinates:i.coordinates||[0,0],mixWithParent:i.mixWithParent||!1}),b(!0))},ve=()=>{I&&(de(I,{name:t.name,description:t.description,backgroundMusic:t.backgroundMusic||void 0,entrySound:t.entrySound||void 0,imageUrl:t.imageUrl||void 0,coordinates:t.coordinates.every(a=>a!==0)?t.coordinates:void 0,parentLocationId:t.parentLocationId||void 0,mixWithParent:t.mixWithParent}),b(!1),W(),_(null),v("Location updated successfully"))},fe=a=>{window.confirm("Are you sure you want to delete this location? This cannot be undone.")&&(ce(a),v("Location deleted successfully"))},be=async()=>{N(!0);try{const a=await he();v(a.message)}catch(a){v(`Error saving data: ${a instanceof Error?a.message:String(a)}`)}finally{N(!1)}},v=a=>{ne(a),D(!0)},ye=()=>{D(!1)},B=(a,i=0)=>{const j=re[a.id]||!1,g=xe(a.id),F=g.length>0;return e.jsxs(o,{sx:{mb:2},children:[e.jsxs(Le,{children:[e.jsx(ke,{children:e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[e.jsxs(o,{children:[e.jsx(p,{variant:"h6",component:"div",children:a.name}),a.imageUrl&&e.jsxs(o,{sx:{mt:1,mb:2,display:"flex",flexDirection:"column",alignItems:"center",height:140,overflow:"hidden",borderRadius:1,border:"1px solid #ddd"},children:[e.jsx(p,{variant:"caption",sx:{mt:.5,color:"text.secondary",fontStyle:"italic"},children:"Map Background:"}),e.jsx(o,{sx:{flex:1,display:"flex",justifyContent:"center",alignItems:"center",width:"100%"},children:e.jsx("img",{src:`/images/${a.imageUrl}`,alt:`Map of ${a.name}`,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"},onError:async M=>{try{if(a.imageUrl){const S=await P.getAssetUrl("images",a.imageUrl);S&&(M.target.src=S)}}catch(S){console.error("Error loading location image:",S)}}})})]}),e.jsx(p,{variant:"body2",color:"text.secondary",sx:{mb:1},children:a.description}),e.jsxs(o,{sx:{mt:1,display:"flex",flexWrap:"wrap",gap:1},children:[a.backgroundMusic&&e.jsx(k,{icon:e.jsx(Q,{}),label:`Music: ${a.backgroundMusic}`,size:"small",variant:"outlined"}),a.entrySound&&e.jsx(k,{icon:e.jsx(Pe,{}),label:`Sound: ${a.entrySound}`,size:"small",variant:"outlined"}),a.coordinates&&e.jsx(k,{label:`Coords: ${a.coordinates[0]}, ${a.coordinates[1]}`,size:"small",variant:"outlined"}),a.mixWithParent&&e.jsx(k,{label:"Mixes with parent",size:"small",color:"primary",variant:"outlined"})]})]}),e.jsxs(o,{children:[e.jsx(f,{onClick:()=>pe(a.id),children:e.jsx(De,{})}),e.jsx(f,{onClick:()=>fe(a.id),children:e.jsx(we,{})}),F&&e.jsx(f,{onClick:()=>ge(a.id),children:j?e.jsx(K,{}):e.jsx(Ee,{})})]})]})}),e.jsx(Ie,{sx:{justifyContent:"flex-end",pt:0},children:e.jsx(d,{size:"small",startIcon:e.jsx(A,{}),onClick:()=>{n({...t,parentLocationId:a.id}),m(!0)},children:"Add Sublocation"})})]}),F&&j&&e.jsx(o,{sx:{pl:4,mt:1},children:g.map(M=>B(M,i+1))})]},a.id)};return e.jsxs(o,{sx:{p:3,maxWidth:1200,mx:"auto"},children:[e.jsxs(o,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[e.jsx(p,{variant:"h4",children:"Locations"}),e.jsxs(o,{children:[e.jsx(d,{variant:"outlined",color:"success",startIcon:e.jsx(Me,{}),onClick:be,disabled:$,sx:{mr:2},children:$?"Saving...":"Save Changes"}),e.jsx(d,{variant:"contained",startIcon:e.jsx(A,{}),onClick:()=>{W(),m(!0)},children:"Add Location"})]})]}),C.length===0?e.jsxs(Ce,{sx:{p:3,textAlign:"center"},children:[e.jsx(p,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No Locations Yet"}),e.jsx(p,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Add your first location to get started."}),e.jsx(d,{variant:"contained",startIcon:e.jsx(A,{}),onClick:()=>m(!0),children:"Add Location"})]}):e.jsx(o,{children:me.map(a=>B(a))}),e.jsxs(z,{open:Z,onClose:()=>m(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(T,{children:"Add New Location"}),e.jsx(O,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Name",fullWidth:!0,value:t.name,onChange:a=>n({...t,name:a.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Parent Location"}),e.jsxs(h,{value:t.parentLocationId,label:"Parent Location",onChange:a=>n({...t,parentLocationId:a.target.value}),children:[e.jsx(r,{value:"",children:e.jsx("em",{children:"None (Top-level)"})}),C.map(a=>e.jsx(r,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:t.description,onChange:a=>n({...t,description:a.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Background Music"}),e.jsxs(h,{value:t.backgroundMusic,label:"Background Music",onChange:a=>n({...t,backgroundMusic:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(a=>e.jsx(r,{value:a,children:a},a))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Entry Sound"}),e.jsxs(h,{value:t.entrySound,label:"Entry Sound",onChange:a=>n({...t,entrySound:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(a=>e.jsx(r,{value:a,children:a},a))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Background Map Image"}),e.jsxs(h,{value:t.imageUrl,label:"Background Map Image",onChange:a=>n({...t,imageUrl:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),U.map(a=>e.jsx(r,{value:a,children:a},a))]}),e.jsx(R,{children:"Image to use as the background map for this location"})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"X Coordinate",type:"number",fullWidth:!0,value:t.coordinates[0],onChange:a=>n({...t,coordinates:[parseFloat(a.target.value)||0,t.coordinates[1]]}),InputProps:{startAdornment:e.jsx(L,{position:"start",children:"X:"})}})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Y Coordinate",type:"number",fullWidth:!0,value:t.coordinates[1],onChange:a=>n({...t,coordinates:[t.coordinates[0],parseFloat(a.target.value)||0]}),InputProps:{startAdornment:e.jsx(L,{position:"start",children:"Y:"})}})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(Y,{control:e.jsx(q,{checked:t.mixWithParent,onChange:a=>n({...t,mixWithParent:a.target.checked})}),label:"Mix audio with parent location"}),e.jsx(X,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(f,{size:"small",children:e.jsx(V,{fontSize:"small"})})})]})]})}),e.jsxs(H,{children:[e.jsx(d,{onClick:()=>m(!1),children:"Cancel"}),e.jsx(d,{onClick:je,variant:"contained",disabled:!t.name,children:"Add Location"})]})]}),e.jsxs(z,{open:ee,onClose:()=>b(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(T,{children:"Edit Location"}),e.jsx(O,{children:e.jsxs(s,{container:!0,spacing:2,sx:{mt:.5},children:[e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Name",fullWidth:!0,value:t.name,onChange:a=>n({...t,name:a.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Parent Location"}),e.jsxs(h,{value:t.parentLocationId,label:"Parent Location",onChange:a=>n({...t,parentLocationId:a.target.value}),children:[e.jsx(r,{value:"",children:e.jsx("em",{children:"None (Top-level)"})}),C.filter(a=>a.id!==I).map(a=>e.jsx(r,{value:a.id,children:a.name},a.id))]})]})}),e.jsx(s,{item:!0,xs:12,children:e.jsx(c,{label:"Description",fullWidth:!0,multiline:!0,rows:3,value:t.description,onChange:a=>n({...t,description:a.target.value})})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Background Music"}),e.jsxs(h,{value:t.backgroundMusic,label:"Background Music",onChange:a=>n({...t,backgroundMusic:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(a=>e.jsx(r,{value:a,children:a},a))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Entry Sound"}),e.jsxs(h,{value:t.entrySound,label:"Entry Sound",onChange:a=>n({...t,entrySound:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),y.map(a=>e.jsx(r,{value:a,children:a},a))]})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsxs(u,{fullWidth:!0,children:[e.jsx(x,{children:"Background Map Image"}),e.jsxs(h,{value:t.imageUrl,label:"Background Map Image",onChange:a=>n({...t,imageUrl:a.target.value}),children:[e.jsx(r,{value:"",children:"None"}),U.map(a=>e.jsx(r,{value:a,children:a},a))]}),e.jsx(R,{children:"Image to use as the background map for this location"})]})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"X Coordinate",type:"number",fullWidth:!0,value:t.coordinates[0],onChange:a=>n({...t,coordinates:[parseFloat(a.target.value)||0,t.coordinates[1]]}),InputProps:{startAdornment:e.jsx(L,{position:"start",children:"X:"})}})}),e.jsx(s,{item:!0,xs:12,md:6,children:e.jsx(c,{label:"Y Coordinate",type:"number",fullWidth:!0,value:t.coordinates[1],onChange:a=>n({...t,coordinates:[t.coordinates[0],parseFloat(a.target.value)||0]}),InputProps:{startAdornment:e.jsx(L,{position:"start",children:"Y:"})}})}),e.jsxs(s,{item:!0,xs:12,children:[e.jsx(Y,{control:e.jsx(q,{checked:t.mixWithParent,onChange:a=>n({...t,mixWithParent:a.target.checked})}),label:"Mix audio with parent location"}),e.jsx(X,{title:"When enabled, entering this location will play its audio alongside the parent location's audio.",children:e.jsx(f,{size:"small",children:e.jsx(V,{fontSize:"small"})})})]})]})}),e.jsxs(H,{children:[e.jsx(d,{onClick:()=>b(!1),children:"Cancel"}),e.jsx(d,{onClick:ve,variant:"contained",disabled:!t.name,children:"Save Changes"})]})]}),e.jsx(Se,{open:ae,autoHideDuration:6e3,onClose:ye,message:te}),e.jsx(Ae,{})]})};export{Xe as LocationsView};
